(this.webpackJsonparena=this.webpackJsonparena||[]).push([[0],{139:function(e,t,n){e.exports=n(245)},144:function(e,t,n){},159:function(e,t){},161:function(e,t){},197:function(e,t){},198:function(e,t){},240:function(e,t,n){},241:function(e,t,n){e.exports=n.p+"static/media/logo-est.bca08fff.png"},242:function(e,t,n){e.exports=n.p+"static/media/tara-logo-et.5947b56d.png"},244:function(e,t,n){e.exports=n.p+"static/media/logo.25bf045c.svg"},245:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(25),s=n.n(c),i=(n(144),n(18)),l=(n(86),n(134)),o=n(36),u=n(1),m=n(2),d=n(3),p=n(4),v=n(5),f=n(7),h=n(45);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E="Process/SEND_MESSAGE",y={};function O(e,t){var n=new t;return function(e,t,n){void 0===y[e]&&(y[e]={}),y[e][t]=n}(e,n.name,(function(e,t){return n.handle(e,t)})),function(e){return function(t){return n.createMessage(g({},void 0===t?{}:t,{},void 0===e?{}:e))}}}function k(e,t,n,a){return{type:E,arena:e,sender:t.name,receivers:0===n.length?[t.name]:n,message:a}}var j=function(){function e(){Object(u.a)(this,e),this.name=void 0}return Object(m.a)(e,[{key:"createMessage",value:function(e){return g({},e,{type:this.name})}},{key:"handle",value:function(e,t){return g({},e,{mem:this.updateMem(e.mem,t)})}},{key:"updateMem",value:function(e,t){return e}},{key:"send",value:function(e,t){return g({},e,{queue:e.queue.concat(t)})}},{key:"withResponse",value:function(e,t,n){return this.send(e,k(t.arena,e,[t.sender],n))}},{key:"withErrorResponse",value:function(e,t,n,a){return this.withResponse(e,t,g({type:"error",error:n},a))}},{key:"withOkResponse",value:function(e,t){return this.withResponse(e,t,{type:"ack",response:"OK"})}}]),e}(),w={};function N(e,t){w[e]=t}var D=function(e){var t=e.process;return JSON.stringify(t.mem)},I={};function S(e,t,n){void 0===I[e]&&(I[e]={}),I[e][t]=n}function P(e,t){return function(e,t){return g({},e,{mem:g({},e.mem,{},t)})}(e,{db:g({},e.mem.db,{},t)})}var C=n(14),x=n(17);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var U="STATE_UPDATE",T="INITIALIZED",_=function e(){Object(u.a)(this,e),this.type=void 0,this.view=void 0,this.mem=void 0,this.statusUpdateChannel=void 0};var F=function(){function e(t,n,a,r,c){Object(u.a)(this,e),this.arena=void 0,this.process=void 0,this.store=void 0,this.url=void 0,this.ui=void 0,this._cachedState=void 0,this._storeUnsubscriber=null,this._messageListener=null,this._channel=void 0,this.arena=t,this.process=n,this.store=a,this.url=new URL(r,window.location.href),this.ui=void 0===c?window.open(r,"".concat(t," - ").concat(n)):c,this._channel=Math.random()}return Object(m.a)(e,[{key:"registerListeners",value:function(){var e=this;return this._storeUnsubscriber=this.store.subscribe((function(){e.stateChanged()})),this._messageListener=function(t){e.processMessage(t)},window.addEventListener("message",this._messageListener),this}},{key:"unregisterListeners",value:function(){return this._storeUnsubscriber(),this._storeUnsubscriber=null,null!==this._messageListener&&(window.removeEventListener("message",this._messageListener),this._messageListener=null),this}},{key:"stateChanged",value:function(){var e=function(e,t,n){var a=e.theatre.arenas.byName[t].process.byName[n];return void 0===a?{type:U,view:""}:{type:U,view:a.view,mem:a.mem}}(this.store.getState(),this.arena,this.process);if(e!==this._cachedState){try{this.ui.postMessage(A({},e,{statusUpdateChannel:this._channel}),this.url.origin)}catch(t){console.error("Error posting message, stopping",t),this.unregisterListeners()}this._cachedState=e}return this}},{key:"processMessage",value:function(e){switch(e.data.type){case T:return this._cachedState=void 0,void this.stateChanged();default:if(e.data.statusUpdateChannel!==this._channel)return;this.store.dispatch({type:E,arena:this.arena,sender:this.process,receivers:[this.process],message:A({},e.data,{statusUpdateChannel:void 0})})}}}]),e}(),M=[];var V=function(){function e(t,n){var a=this;Object(u.a)(this,e),this.state=void 0,this.setter=void 0,this.caster=void 0,this.setter=t,this.caster=n,console.log("setting listener"),window.addEventListener("message",(function(e){a.receiveNewState(e)}))}return Object(m.a)(e,[{key:"setState",value:function(e){console.log("updating state:",e),this.state=e,this.setter(new this.caster(e).withUpdater(this))}},{key:"resetState",value:function(){this.postMessage(T,{target:window.name,url:window.location.href})}},{key:"postMessage",value:function(e,t){if(null!==window.opener){var n=void 0!==this.state?{statusUpdateChannel:this.state.statusUpdateChannel}:{},a=Object.assign({},void 0===t?{}:t,{type:e},n);console.log("posting message:",a),window.opener.postMessage(a)}else this.setState({type:U,view:"",mem:{error:"NO OPENER WINDOW"}})}},{key:"receiveNewState",value:function(e){e.data.type===U&&this.setState(e.data)}}]),e}(),L=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this))).updater=void 0,Object.assign(Object(C.a)(n),e),n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"withUpdater",value:function(e){return this.updater=e,this}},{key:"post",value:function(e){var t=e();this.updater.postMessage(t.type,t)}},{key:"arena",value:function(){return window.name.split(" - ")[0]}}]),t}(_),q=n(40),H=n(125),B=n(126),z=n(35);q.a.use(H.a).use(B.a).use(z.a).init({fallbackLng:"et",debug:!1,interpolation:{escapeValue:!1}});q.a;function K(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var r=n.join("."),c=e.arena,s=e.process.name,i=e.process.type;return q.a.t([[c,s],[c,i],[i],[]].map((function(e){return e.concat(r).join(".")})))}function J(e,t,n){return K({arena:e,process:{name:t,type:n}},"stylename")}function G(e){return function(e,t){return q.a.t(["person.".concat(e,".").concat(t),"person.default.".concat(t)]).replace("ISIKUKOOD",e)}(e,"name")}function W(e,t){return q.a.t("business.".concat(e,".").concat(t))}function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function $(e,t){return r.a.createElement("span",{className:"msg-".concat(J(e,t))},t)}function Q(e,t){return 1===t.length?$(e,t[0]):r.a.createElement(r.a.Fragment,null,"(",t.map((function(t,n){return r.a.createElement(r.a.Fragment,null,0===n?", ":void 0,$(e,t))})),")")}function Z(e){return"".concat(e.type,": ").concat(JSON.stringify(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{type:void 0,statusUpdateChannel:void 0}),(t=40,function(e,n){return"string"!==typeof n?n:n.length>t?n.substring(0,t)+"...":n}),"  "));var t}function Y(e,t,n){return r.a.createElement(r.a.Fragment,null,function(e,t){return void 0===t?r.a.createElement(r.a.Fragment,null,$(e.arena,e.sender),r.a.createElement("span",null," \xbb "),Q(e.arena,e.receivers)):e.sender===t.name?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"\xbb "),Q(e.arena,e.receivers)):r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"\xab "),$(e.arena,e.sender))}(t,n),": ",Z(t.message))}function ee(e,t,n,a,c){return r.a.createElement("span",{onClick:function(e){return c(n)}},function(e,t){if(void 0===te[e])return Y;if(void 0===te[e][t.message.type])return Y;return te[e][t.message.type]}(e,n)(e,n,a))}var te={};function ne(e,t){Object.keys(t).forEach((function(n){return function(e,t,n){void 0===te[e]&&(te[e]={}),te[e][t]=n}(e,n,t[n])}))}var ae=n(247),re=n(248),ce=n(132);function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var ie=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={msg:void 0},n.filterFn=function(e){return!(1===e.receivers.length&&e.receivers.includes(e.sender)&&!n.props.showSelf)&&!(void 0!==n.props.owner&&e.sender!==n.props.owner.name&&!e.receivers.includes(n.props.owner.name))},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"closePopup",value:function(){this.setState({msg:void 0})}},{key:"showPopup",value:function(e){this.setState({msg:e})}},{key:"formatLogLine",value:function(e,t,n){var r=this;return a.createElement("li",{className:"log-item",key:t},ee(this.props.arena,0,e,n,(function(e){r.showPopup(e)})))}},{key:"popup",value:function(){var e,t=this.state.msg,n=this,r=this.props.t||function(e){return e};return a.createElement(ae.a,{show:void 0!==t,onHide:function(){return n.closePopup()},size:"lg"},a.createElement(ae.a.Body,null,void 0===t?"No message?":a.createElement("div",null,a.createElement("div",{className:"row"},a.createElement("h4",null,"Saatja:"),a.createElement("p",null,t.sender)),a.createElement("div",{className:"row"},a.createElement("h4",null,"Saaja:"),a.createElement("p",null,1===(e=t.receivers).length?e[0]:"(".concat(e.join(", "),")"))),a.createElement("div",{className:"row"},a.createElement("h4",null,"T\xfc\xfcp:"),a.createElement("p",null,t.message.type)),a.createElement("div",{className:"col"},a.createElement("pre",{className:"text-left"},JSON.stringify(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{type:void 0,statusUpdateChannel:void 0,arena:void 0}),void 0,"  "))))),a.createElement(ae.a.Footer,null,a.createElement(re.a,{variant:"secondary",onClick:function(e){return n.closePopup()}},r("close"))))}},{key:"render",value:function(){var e=this,t=this.props.rows.filter(this.filterFn).slice(-(this.props.maxRows||4));return 0===t.length?a.createElement(a.Fragment,null,K({arena:this.props.arena,process:this.props.owner||{}},"no-log-lines")):a.createElement(a.Fragment,null,this.popup(),a.createElement("ul",{className:"log-view"},t.map((function(t,n){return e.formatLogLine(t,n,e.props.owner)}))))}}]),t}(a.Component);var le=Object(i.b)((function(e,t){return{rows:Nn(e,t.arena).log}}))(ie),oe=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={show:!1},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props.t;return a.createElement(a.Fragment,null,a.createElement(ae.a,{show:this.state.show,onHide:function(){return e.setState({show:!1})},size:"lg"},a.createElement(ae.a.Header,null,a.createElement(ae.a.Title,null,K({arena:this.props.arena,process:this.props.owner},"log"),": ",void 0!==this.props.owner?K({arena:this.props.arena,process:this.props.owner},"title"):a.createElement(a.Fragment,null))),a.createElement(ae.a.Body,null,a.createElement("div",{className:"msg-log-popup msg-log"},a.createElement(le,this.props))),a.createElement(ce.a,null,a.createElement(re.a,{variant:"secondary",onClick:function(t){return e.setState({show:!1})}},t("close")))),a.createElement(re.a,{className:this.props.className,onClick:function(t){return e.setState({show:!0})}},this.props.children))}}]),t}(a.PureComponent);function ue(e){var t=e.process,n=e.arena;return function(e){return void 0===I[e.type]?(console.error("No renderer for ".concat(e.type)),D):void 0===I[e.type][e.view]?(console.error("No renderer for ".concat(e.type," and view ").concat(e.view)),D):I[e.type][e.view]}(t)({process:t,arena:n})}function me(e){var t=e.process,n=e.arena,r=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return K.apply(void 0,[{arena:n,process:t}].concat(a))};return a.createElement("div",{className:"col"},a.createElement("div",{className:"card process style-".concat(r("stylename")),id:"proc-".concat(t.name)},a.createElement("div",{className:"card-header"},a.createElement("span",{className:"process-name",onClick:function(e){e.preventDefault(),alert(JSON.stringify(t,void 0,"  "))}},r("title")),a.createElement(oe,{arena:n,owner:t,showSelf:!0,maxRows:100,t:r,className:"btn-log btn-light btn-sm"},"log")),a.createElement("div",{className:"card-body"},a.createElement("span",{className:"process-state"},ue({process:t,arena:n})))))}function de(e){var t=e.arena,n=e.process,r=e.children,c=e.button,s=Object(i.c)();function l(){!function(e,t,n,a){M.push(new F(e,t,a,n).registerListeners())}(t,n.name,w[n.type],s)}var o=!0===c?"button":"div";return void 0===w[n.type]?a.createElement(a.Fragment,null):a.createElement(o,{className:!0!==c?"process-uilink":"btn btn-primary",onClick:function(){return l()}},void 0===r?"\u2398":r)}function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pe(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{byName:{},allNames:[]},t=arguments.length>1?arguments[1]:void 0;return{byName:ve({},e.byName,Object(f.a)({},t.name,t)),allNames:e.allNames.filter((function(e){return e!==t.name})).concat(t.name)}}function he(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{byName:{},allNames:[]},t=arguments.length>1?arguments[1]:void 0;return ve({},e,{byName:Object.assign.apply(Object,[{}].concat(Object(h.a)(e.allNames.map((function(n){return Object(f.a)({},n,t(e.byName[n]))})))))})}function be(e){return e.reduce(fe,{byName:{},allNames:[]})}function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ge(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ye=300,Oe=fe,ke=he;var je="Arena/CREATE_PROCESS",we="Arena/FLUSH_QUEUE";function Ne(e,t){if(t.arena!==e.name)return e;switch(t.type){case je:return Ee({},e,{process:Oe(e.process,t.process)});case we:return Ee({},e,{process:ke(e.process,(function(e){return Ee({},e,{queue:[]})}))});case E:return Ee({},e,{process:ke(e.process,(function(e){return function(e,t){return t.type===E&&t.receivers.includes(e.name)?void 0===y[e.type]?(console.error("No handler for ".concat(e.name," (").concat(e.type,")")),e):void 0===y[e.type][t.message.type]?(console.error("No handler for ".concat(e.name," (").concat(e.type,") for message ").concat(t.message.type," (").concat(JSON.stringify(t.message),")")),e):y[e.type][t.message.type](e,t):e}(e,t)})),log:e.log.concat([t])});default:return e}}function De(e){var t=function(e){return e.allNames.map((function(t){return(n=e.byName[t].process).allNames.map((function(e){return n.byName[e].queue})).flat(1).filter((function(e){return void 0!==e}));var n})).flat(1)}(e.getState().theatre.arenas);if(0!==t.length){Object.keys(Object.assign.apply(Object,[{}].concat(Object(h.a)(t.map((function(e){return Object(f.a)({},e.arena,1)})))))).forEach((function(t){return e.dispatch({type:we,arena:t})}));window.setTimeout((function(){!function e(t,n){n.length>0&&(t.dispatch(Ee({},n.shift(),{now:Date.now()/1e3|0,random:""+Math.random()})),window.setTimeout((function(){e(t,n)}),ye))}(e,t)}),ye)}}var Ie=Object(i.b)((function(e,t){return{log:Nn(e,t.arena.name).log}}))((function(e){var t=e.arena,n=Object(z.b)().t,r=t.process.allNames.map((function(e){return a.createElement(me,{process:t.process.byName[e],arena:t.name,key:e})}));return a.createElement("div",null,a.createElement("div",{className:"row"},r),a.createElement("div",{className:"card w-100 mt-4 mb-2"},a.createElement("div",{className:"card-body"},a.createElement("h5",{className:"card-title"},n("msg-log.title")),0===t.log.length&&a.createElement("div",{className:"d-flex align-items-center"},a.createElement("div",{className:"spinner-grow spinner-grow-sm",role:"status"}),a.createElement("p",{className:"card-text ml-1"},n("msg-log.empty"))),a.createElement("div",{className:"msg-log-wrapper"},a.createElement("samp",{className:"msg-log"},a.createElement(le,{arena:t.name,showSelf:!1,maxRows:1e3}),a.createElement("span",{className:"msg-log-anchor"},"\xa0"))))))}));function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Pe(e){return"string"===typeof e&&e.startsWith("{")?JSON.parse(e):e}function Ce(e){return void 0===e||null===e?{}:Array.from(e.elements).map((function(t,n){return e.elements[n]})).filter((function(e){return void 0!==e.name&&null!==e.name&&""!==e.name&&!e.name.startsWith("_")})).map((function(e){if("select-multiple"===e.type){var t,n=[];for(t=0;t<e.options.length;t++)e.options[t].selected&&n.push(Pe(e.options[t].value));return Object(f.a)({},e.name,n)}if("checkbox"===e.type){var a=e.value.split("|",2);return 1===a.length&&a.push(void 0),Object(f.a)({},e.name,Pe(a[e.checked?0:1]))}return Object(f.a)({},e.name,Pe(e.value))})).reduce((function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{},t)}),{})}var xe=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handleClick",value:function(e){e.preventDefault(),this.props.messageToAction(this.props,Ce(e.currentTarget.form)),this.props.onClick&&this.props.onClick(e)}},{key:"render",value:function(){var e=this;return a.createElement("button",{className:void 0===this.props.className?"btn btn-primary":this.props.className,onClick:function(t){return e.handleClick(t)},title:this.props.title},this.props.text)}}]),t}(a.Component),Re=Object(i.b)(null,{messageToAction:function(e,t){return k(e.arena,e.owner,(n=e.owner,void 0!==(a=e.target)&&"string"===typeof a?[a]:void 0===a||0===a.length?[n.name]:a),e.message(t));var n,a}})(xe),Ae="Counter",Ue="_";var Te=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Counter/INC",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"updateMem",value:function(e,t){return e+1}}]),t}(j),_e=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Counter/DEC",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"updateMem",value:function(e,t){return e-1}}]),t}(j),Fe=O(Ae,Te),Me=O(Ae,_e);S(Ae,Ue,(function(e){var t=e.process,n=e.arena;return a.createElement("div",null,a.createElement("span",{className:"process-state"},t.mem),a.createElement("span",{className:"process-state"},a.createElement(Re,{arena:n,owner:t,text:"+",message:Fe()}),a.createElement(Re,{arena:n,owner:t,text:"-",message:Me()})),a.createElement("span",{className:"process-state"},a.createElement(le,{arena:n,owner:t,showSelf:!0,maxRows:4})))}));var Ve=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={open:!1},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;return a.createElement("div",null,a.createElement("div",{className:this.state.open?"popup-visible":"popup-hidden"},a.createElement("div",{className:"popup-content"},a.createElement("div",{className:"popup-close",onClick:function(){return e.setState({open:!1})}}),this.props.children)),a.createElement("button",{className:"btn btn-primary",onClick:function(){return e.setState({open:!0})}},this.props.text))}}]),t}(a.Component),Le="login",qe=function(){return a.createElement("div",{className:"app-header"},a.createElement("div",{className:"app-user-icon"},a.createElement("img",{alt:"user icon",src:n(87)})),a.createElement("p",{className:"app-user"},"TERE MARI-LIIS M\xc4NNIK"))},He=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).state={view:Le,loading:!1},n.changeView=function(e){n.setState({loading:!0}),setTimeout((function(){n.setState({loading:!1}),n.setState({view:e})}),1e3)},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;switch(this.state.loading){case!0:return a.createElement("div",{className:"d-flex align-items-center"},a.createElement("strong",null,"Loading..."),a.createElement("div",{className:"spinner-border ml-auto",role:"status","aria-hidden":"true"}));default:switch(this.state.view){case Le:return a.createElement("div",null,a.createElement("h4",null,"Tere! Teenuse kasutamiseks logi palun sisse."),a.createElement("button",{className:"btn btn-light border",onClick:function(){return e.changeView("selectService")}},"Logi sisse kasutajana Mari-Liis M\xe4nnik 47302200234"),a.createElement("p",{className:"mt-4"},a.createElement("img",{alt:"illustration",src:n(88),width:"280"})));case"selectService":return a.createElement("div",null,a.createElement(qe,null),a.createElement("h4",null,"Vali teenus mida soovid kasutada:"),a.createElement("button",{className:"btn btn-dark",onClick:function(){return e.changeView("serviceV1")}},"Vaktsineerimiste meeldetuletused"));case"serviceV1":return a.createElement("div",null,a.createElement(qe,null),a.createElement("h4",null,"Teenuse tekst TODO"),a.createElement("p",{className:"text-left"},a.createElement("small",null,"Enne n\xf5usoleku andmist veendu, et oled tutvunud meie privaatsuspoliitika ja kasutustingimustega, mis on leiavad ",a.createElement("a",{href:"JavaScript:void(0);"},"siin"),". N\xf5usoleku andmiseks suuname Sind e-Tervise n\xf5usolekute keskkonda, mida haldab Tervise- ja Heaolu Infos\xfcsteemide Keskus.")),a.createElement("button",{className:"btn btn-lg btn-primary"},"Annan n\xf5usoleku"));default:return null}}}}]),t}(a.PureComponent);function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ke="TokenNode",Je="with",Ge="without";function We(e,t,n,a){return{title:e,name:t,type:Ke,view:void 0===a?Ge:Je,mem:{token:a,next:n},queue:[]}}var Xe=O(Ke,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="TokenNode/InitPass",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return e.view!==Je?(console.error("Invalid message, order to pass while I have no token? ".concat(JSON.stringify(e))),e):ze({},e,{queue:e.queue.concat(k(t.arena,e,[e.mem.next],$e({token:e.mem.token})())),mem:ze({},e.mem,{token:void 0}),view:Ge})}}]),t}(j)),$e=O(Ke,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="TokenNode/PostToken",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return e.view===Je?(console.log("".concat(t.sender," sent token '").concat(t.message.token,"' to ").concat(e.name,". We already have a token (").concat(e.mem.token,"). Will send the token back")),ze({},e,{queue:e.queue.concat(k(t.arena,e,[t.sender],t.message))})):ze({},e,{mem:ze({},e.mem,{token:t.message.token}),view:Je})}}]),t}(j)),Qe=O(Ke,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="TokenNode/UpdateTarget",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"updateMem",value:function(e,t){return ze({},e,{next:t.message.target})}}]),t}(j)),Ze=function(e){var t=e.process,n=e.arena,r=Object(z.b)().t,c=a.useState(!1),s=Object(x.a)(c,2),i=s[0],l=s[1],o=function(){return l(!1)},u=function(){return l(!0)};switch(t.name){case"a":return a.createElement(a.Fragment,null,a.createElement(ae.a,{show:i,onHide:o,size:"lg"},a.createElement(ae.a.Header,{closeButton:!0},a.createElement(ae.a.Title,null,"Teenusedeklaratsiooni registreerimine")),a.createElement("form",null,a.createElement(ae.a.Body,null,a.createElement("div",{className:"row"},a.createElement("div",{className:"col"},a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"baseName"},"Andmekogu nimi:"),a.createElement("input",{name:"baseName",type:"text",className:"form-control",id:"baseName",value:"test",readOnly:!0})),a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"xtee"},"Andmekogu X-tee:"),a.createElement("input",{name:"xtee",type:"text",className:"form-control",id:"xtee",value:"123",readOnly:!0}),a.createElement("small",{id:"xteeHelp",className:"form-text text-muted"},"(alams\xfcsteemi) identifikaator.")),a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"sdName"},"Teenusedeklaratsiooni nimi:"),a.createElement("input",{name:"sdName",type:"text",className:"form-control",id:"sdName"}),a.createElement("small",{id:"sdNameHelp",className:"form-text text-muted"},"Teenusedeklaratsiooni identifikaator inimloetaval kujul. Soovitatavalt teenuse kood/nimi ja vajadusel alamteenuse identifikaator."))),a.createElement("div",{className:"col"},a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"sdIdentifier"},"Teenusedeklaratsiooni identifikaator:"),a.createElement("input",{name:"sdIdentifier",type:"text",className:"form-control",id:"sdIdentifier"}),a.createElement("small",{id:"sdIdentifierHelp",className:"form-text text-muted"},"Andmekogu poolt m\xe4\xe4ratud teenusedeklaratsiooni masinloetav identifikaator.")),a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"sdDescription"},"Teenuse andmekoosseisu kirjeldus:"),a.createElement("input",{name:"sdDescription",type:"text",className:"form-control",id:"sdDescription"}),a.createElement("small",{id:"sdDescriptionHelp",className:"form-text text-muted"},"Teenuse poolt tagastatava andmekoosseisu inimloetav kirjeldus. Kuvatakse n\xf5usoleku andmisel andmesubjektile.")),a.createElement("div",{className:"form-group"},a.createElement("div",{className:"form-check"},a.createElement("input",{name:"signature",className:"form-check-input",type:"checkbox",id:"signature"}),a.createElement("label",{className:"form-check-label",htmlFor:"signature"},"Vajab digiallkirja?"),a.createElement("small",{id:"signatureHelp",className:"form-text text-muted"},"M\xe4rgista see v\xe4li, kui andmesubjekt peab selle teenuse andmetele n\xf5usoleku andmisel n\xf5usoleku digitaalselt allkirjastama.")))))),a.createElement(ae.a.Footer,null,a.createElement(re.a,{variant:"secondary",onClick:o},"Close"),a.createElement(Re,{arena:n,owner:t,onClick:function(){return o()},text:"Update",message:Qe()})))),a.createElement(re.a,{variant:"primary",onClick:u},r("register")));case"b":return a.createElement(a.Fragment,null,a.createElement(ae.a,{show:i,onHide:o,size:"lg"},a.createElement(ae.a.Header,{closeButton:!0},a.createElement(ae.a.Title,null,"Eesm\xe4rgideklaratsiooni registreerimine")),a.createElement("form",null,a.createElement(ae.a.Body,null,a.createElement("div",{className:"row"},a.createElement("div",{className:"col"},a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"applicationName"},"Klientrakenduse nimi:"),a.createElement("input",{name:"applicationName",type:"text",className:"form-control",id:"applicationName",value:"test",readOnly:!0})),a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"applicationXtee"},"Klientrakenduse X-tee:"),a.createElement("input",{name:"applicationXtee",type:"text",className:"form-control",id:"applicationXtee",value:"123",readOnly:!0}),a.createElement("small",{id:"applicationXteeHelp",className:"form-text text-muted"},"(alams\xfcsteemi) identifikaator.")),a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"dIdentifier"},"Deklaratsiooni identifikaator:"),a.createElement("input",{name:"dIdentifier",type:"text",className:"form-control",id:"dIdentifier"}),a.createElement("small",{id:"dIdentifierHelp",className:"form-text text-muted"},"Klientrakenduse poolt m\xe4\xe4ratud eesm\xe4rgideklaratsiooni identifikaator"))),a.createElement("div",{className:"col"},a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"dataUsage"},"Andmete kasutamise eesm\xe4rk:"),a.createElement("input",{name:"dataUsage",type:"text",className:"form-control",id:"dataUsage"}),a.createElement("small",{id:"dataUsageHelp",className:"form-text text-muted"},"Andmesubjekti andmete t\xf6\xf6tlemise eesm\xe4rk. Kuvatakse n\xf5usoleku andmisel andmesubjektile.")),a.createElement("div",{className:"form-group"},a.createElement("label",{htmlFor:"services"},"Kasutatavad teenused:"),a.createElement("select",{name:"services",className:"custom-select",multiple:!0,defaultValue:["1"],id:"services"},a.createElement("option",{value:"1"},"One"),a.createElement("option",{value:"2"},"Two"),a.createElement("option",{value:"3"},"Three")))))),a.createElement(ae.a.Footer,null,a.createElement(re.a,{variant:"secondary",onClick:o},"Close"),a.createElement(Re,{arena:n,owner:t,onClick:function(){return o()},text:"Update",message:Qe()})))),a.createElement(re.a,{variant:"primary",onClick:u},r("register")));case"c":return a.createElement(a.Fragment,null,a.createElement(ae.a,{show:i,onHide:o,size:"lg",bsPrefix:"client-app modal"},a.createElement(ae.a.Header,null,a.createElement(ae.a.Title,null,"HealthStartup")),a.createElement(ae.a.Body,null,a.createElement(He,null)),a.createElement(ae.a.Footer,null,a.createElement(re.a,{variant:"outline-dark",onClick:o},"Close"))),a.createElement(re.a,{variant:"primary",onClick:u},r("continue")));default:return a.createElement(Ve,{text:"Set target"},a.createElement("form",null,a.createElement("input",{name:"target",size:20}),a.createElement(Re,{arena:n,owner:t,text:"Update target",message:Qe()})))}};S(Ke,Je,(function(e){var t=e.process,n=e.arena;return a.createElement("div",null,a.createElement("span",{className:"process-state"},t.mem.token),a.createElement("span",{className:"process-state"},"next: ",t.mem.next),a.createElement("span",{className:"process-state d-none"},a.createElement(Re,{arena:n,owner:t,text:"Pass the token",message:Xe()})),a.createElement(Ze,{arena:n,process:t}),a.createElement("span",{className:"process-state"},a.createElement(le,{arena:n,owner:t,showSelf:!0,maxRows:4})))})),S(Ke,Ge,(function(e){var t=e.process,n=e.arena;return a.createElement("div",null,a.createElement(Ze,{arena:n,process:t}),a.createElement("span",{className:"process-state"},a.createElement(le,{arena:n,owner:t,showSelf:!0,maxRows:2})))})),N(Ke,"/ui/dummy");var Ye="ClientIS",et="loginView",tt="ConsentService",nt="loginView";function at(e,t){return e.find((function(e){return 0===Object.keys(t).filter((function(n){return e[n]!==t[n]})).length}))}var rt=n(133);function ct(e){return Object(rt.createHash)("sha256").update(e).digest("hex").substring(0,6)}function st(e){var t=e.match("^([^/]+/[^/]+/[^/]+)(/.*)?$");return null===t?e:t[1]}function it(e){var t=[];function n(e){return e[e.length-1]}return t.push({text:"",indent:-1,children:[]}),e.split("\n").forEach((function(e){var a=e.match("^((  )+\\* )(.*)$");null===a&&(a=["","","",e]);for(var r=a[1],c=a[3];r.length<=n(t).indent;)t.pop();r.length>n(t).indent&&(n(t).children.push({text:c,indent:r.length,children:[]}),t.push(n(n(t).children)))})),t[0].children.map((function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{className:"desc-markup"},e.text),function e(t){return 0===t.length?r.a.createElement(r.a.Fragment,null):r.a.createElement("ul",{className:"desc-markup"},t.map((function(t){return r.a.createElement("li",{className:"desc-markup"},t.text,e(t.children))})))}(e.children))}))}function lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lt(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ut=O(tt,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/addServiceDeclaration",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"addServiceDeclaration",value:function(e,t){return P(e,{serviceDeclarations:e.mem.db.serviceDeclarations.concat(t)})}},{key:"handle",value:function(e,t){console.log("addServiceDeclaration: ".concat(JSON.stringify(t)));var n=t.message;return void 0!==at(e.mem.db.serviceDeclarations,{serviceProviderId:n.serviceProviderId,serviceDeclarationId:n.serviceDeclarationId})?this.withErrorResponse(e,t,"duplicate_declaration"):n.serviceProviderId!==st(t.sender)?this.withErrorResponse(e,t,"invalid_request",{msg:"serviceProvcderId in declaration and message do not match"}):void 0!==n.serviceDeclarationId&&n.serviceDeclarationId.match("^[!-~]+$")?this.withOkResponse(this.addServiceDeclaration(e,ot({},t.message,{type:void 0})),t):this.withErrorResponse(e,t,"invalid_request",{msg:"Invalid service declaration id"})}}]),t}(j)),mt=O(tt,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/addPurposeDeclaration",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"addPurposeDeclaration",value:function(e,t){return P(e,{purposeDeclarations:e.mem.db.purposeDeclarations.concat(t)})}},{key:"handle",value:function(e,t){console.log("addPurposeDeclaration: ".concat(JSON.stringify(t)));var n=t.message;return void 0!==at(e.mem.db.purposeDeclarations,{clientId:n.clientId,purposeDeclarationId:n.purposeDeclarationId})?this.withErrorResponse(e,t,"duplicate_declaration"):n.clientId!==st(t.sender)?this.withErrorResponse(e,t,"invalid_request",{msg:"clientId in declaration and message do not match"}):void 0!==n.purposeDeclarationId&&n.purposeDeclarationId.match("^[!-~]+$")?0===n.services.length||void 0!==n.services.find((function(t){return void 0===at(e.mem.db.serviceDeclarations,t)}))?this.withErrorResponse(e,t,"invalid_request",{msg:"Invalid or missing SD reference(s)"}):this.withOkResponse(this.addPurposeDeclaration(e,ot({},t.message,{type:void 0})),t):this.withErrorResponse(e,t,"invalid_request",{msg:"Invalid purpose declaration id"})}}]),t}(j));function dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function pt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dt(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var vt=O(tt,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/UI/login",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return console.log("login message: ",t),pt({},e,{mem:pt({},e.mem,{ui:pt({},e.mem.ui,{user:t.message.user})})})}}]),t}(j)),ft=O(tt,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/UI/giveConsent",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"addConsent",value:function(e,t){return P(e,{consents:e.mem.db.consents.concat(t)})}},{key:"handle",value:function(e,t){var n=t.message;if(void 0===at(e.mem.db.purposeDeclarations,{clientId:n.clientId,purposeDeclarationId:n.purposeDeclarationId}))return console.error("Attempt to add consent for unknown purpose declaration: ",n),e;if(void 0!==at(e.mem.db.consents,{clientId:t.message.clientId,purposeDeclarationId:t.message.purposeDeclarationId,dataSubject:t.message.dataSubject,revoked:!1}))return console.error("Attempt to add duplicate consent?"),e;console.log("Adding consent: ",t.message);var a=this.addConsent(e,pt({},t.message,{type:void 0})),r=e.mem.ui.user;if(void 0===r||void 0===e.mem.ui.activePurposeDeclaration[r])return a;var c=e.mem.ui.activePurposeDeclaration[r],s=gt(a,r,void 0);return c.clientId!==t.message.clientId||c.purposeDeclarationId!==t.message.purposeDeclarationId||void 0===c.callbackURL?s:this.send(s,k(t.arena,a,[c.callbackURL],Kt({purposeDeclarationId:c.purposeDeclarationId})()))}}]),t}(j)),ht=O(tt,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/UI/revokeConsent",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"revokeIfReferenceEquals",value:function(e,t){return e.consentReference===t.consentReference?pt({},e,{revoked:!0,validUntil:t.revokeAt}):e}},{key:"revokeConsent",value:function(e,t){var n=this;return P(e,{consents:e.mem.db.consents.map((function(e){return n.revokeIfReferenceEquals(e,t)}))})}},{key:"handle",value:function(e,t){return this.revokeConsent(e,t.message)}}]),t}(j));function bt(e,t,n){return pt({},e,Object(f.a)({},t,n))}function gt(e,t,n){return pt({},e,{mem:pt({},e.mem,{ui:pt({},e.mem.ui,{activePurposeDeclaration:bt(e.mem.ui.activePurposeDeclaration,t,n)})})})}var Et=O(tt,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/UI/activatePurposeDeclaration",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return gt(e,void 0===t.message.user?e.mem.ui.user:t.message.user,{clientId:t.message.clientId,purposeDeclarationId:t.message.purposeDeclarationId})}}]),t}(j));function yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Ot="CS/getConsentReference/response";function kt(e){return function(t){return!t.revoked&&t.validUntil<e?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yt(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{revoked:!0}):t}}var jt=O(tt,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/getConsentReference",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){var n=t.message,a=P(e,{consents:e.mem.db.consents.map(kt(t.now))}),r=at(a.mem.db.consents,{purposeDeclarationId:n.purposeDeclarationId,dataSubject:n.subjectId,revoked:!1});return void 0===r?this.withErrorResponse(gt(a,n.subjectId,{clientId:n.clientId,purposeDeclarationId:n.purposeDeclarationId,callbackURL:n.callbackURL}),t,"consent_not_found"):this.withResponse(a,t,{type:Ot,clientId:t.message.clientId,purposeDeclarationId:t.message.purposeDeclarationId,consentReference:r.consentReference})}}]),t}(j)),wt="ServiceProviderIS",Nt="defaultView",Dt="SP/request",It="SP/request/response";function St(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var Pt="CS/validateConsentReference/response",Ct={type:Pt,asyncId:"",valid:!1},xt=O(tt,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/validateConsentReference",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"notValid",value:function(e,t){return this.withResponse(e,t,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?St(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):St(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Ct,{asyncId:t.message.asyncId}))}},{key:"handle",value:function(e,t){var n=e.mem.db.consents.find((function(e){return e.consentReference===t.message.consentReference}));if(void 0===n)return console.log("No such consent found: ",t.message.consentReference),this.notValid(e,t);var a=t.now;if(n.revoked||a<n.validFrom||a>n.validUntil)return console.log("Consent ".concat(n," is not valid")),this.notValid(e,t);var r=st(t.sender),c=e.mem.db.purposeDeclarations.find((function(e){return e.clientId===n.clientId&&e.purposeDeclarationId===n.purposeDeclarationId}));if(void 0===c)return console.error("Cannot find purposeDeclaration that matches to an existing consent?"),this.notValid(e,t);var s=c.services.filter((function(e){return e.serviceProviderId===r})).map((function(e){return e.serviceDeclarationId}));if(r===n.clientId){var i={type:Pt,asyncId:t.message.asyncId,valid:!0,consentReference:t.message.consentReference,consentExpiration:new Date(1e3*n.validUntil).toISOString(),dataSubjectId:n.dataSubject,clientId:n.clientId,purposeDeclarationId:n.purposeDeclarationId,serviceDeclarationId:s};return this.withResponse(e,t,i)}if(s.length>0){var l={type:Pt,asyncId:t.message.asyncId,valid:!0,consentReference:t.message.consentReference,consentExpiration:new Date(1e3*n.validUntil).toISOString(),dataSubjectId:n.dataSubject,clientId:n.clientId,serviceDeclarationId:s};return this.withResponse(e,t,l)}return this.notValid(e,t)}}]),t}(j));function Rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}var At=O(tt,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/reportServiceUsage",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"addUsageRecord",value:function(e,t){return P(e,{usageLog:e.mem.db.usageLog.concat(t)})}},{key:"handle",value:function(e,t){return this.withOkResponse(this.addUsageRecord(e,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rt(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t.message,{type:void 0})),t)}}]),t}(j));function Ut(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ut(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ut(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _t=O(wt,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="ServiceProvider/UI/addData",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){if(void 0===t.message.datatype||""===t.message.datatype)return Tt({},e,{mem:Tt({},e.mem,{db:e.mem.db.filter((function(e){return e.key!==t.message.key}))})});var n=t.message,a={key:n.key,type:n.datatype,subject:n.subject,data:n.data};return Tt({},e,{mem:Tt({},e.mem,{db:e.mem.db.concat(a)})})}}]),t}(j)),Ft=O(wt,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="ServiceProvider/UI/declareService",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return this.send(e,k(t.arena,e,[e.mem.services[0].consentService],ut()(t.message)))}}]),t}(j));function Mt(e,t){return ct(e.clientId+e.consentReference+e.requestReference+e.serviceName+e.subjectId+t.consentService)}var Vt=O(wt,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name=Dt,n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){function n(n,a){return k(t.arena,e,n,a)}var a=t.message,r=e.mem.services.find((function(e){return e.serviceName===a.serviceName}));if(void 0===r)return this.withErrorResponse(e,t,"invalid_request");if(a.clientId!==st(t.sender))return this.withErrorResponse(e,t,"invalid_request");if(!a.consentReference){var c={result:"ACCESS_DENIED",clientId:a.clientId,subjectId:a.subjectId,serviceDeclarationIds:r.requiredServiceDeclarationIds,requestReference:a.requestReference,serviceProviderId:e.name,usageTime:t.now};return this.send(this.send(e,n([r.consentService],At()(c))),n([t.clientAddress],{type:"error",error:"ACCESS_DENIED"}))}var s=Tt({},a,{validationRequestId:Mt(a,r),clientAddress:t.sender}),i=Tt({},e,{mem:Tt({},e.mem,{inflight:e.mem.inflight.concat(s)})});return this.send(i,k(t.arena,i,[r.consentService],xt()({asyncId:s.validationRequestId,partyId:e.name,consentReference:a.consentReference,requestReference:a.requestReference})))}}]),t}(j));O(wt,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name=Pt,n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){function n(n,a){return k(t.arena,e,n,a)}var a=e.mem.inflight.find((function(e){return e.validationRequestId===t.message.asyncId})),r=t.message;function c(e){return Tt({},e,{mem:Tt({},e.mem,{inflight:e.mem.inflight.filter((function(e){return void 0===a||e.requestReference!==a.requestReference}))})})}if(void 0===a)return console.error("Failed to find original inflight request, ignoring the response."),e;var s=e.mem.services.find((function(e){return e.serviceName===a.serviceName}));if(void 0===s)return console.error("Failed to find the service specified in the original inflight request, ignoring the response."),c(e);var i={result:"OK",clientId:a.clientId,subjectId:a.subjectId,serviceDeclarationIds:t.message.serviceDeclarationId,consentReference:a.consentReference,requestReference:a.requestReference,serviceProviderId:e.name,usageTime:t.now};return r.clientId===a.clientId&&r.consentReference===a.consentReference&&r.dataSubjectId===a.subjectId&&r.valid?this.send(this.send(c(e),n([s.consentService],At()(Tt({},i,{result:"OK"})))),n([a.clientAddress],Xt()({records:e.mem.db.filter((function(e){return e.subject===a.subjectId})).filter((function(e){return s.returnedDatatypes.includes(e.type)})),asyncId:a.requestReference}))):this.send(this.send(c(e),n([s.consentService],At()(Tt({},i,{result:"ACCESS_DENIED"})))),n([a.clientAddress],{type:"error",error:"ACCESS_DENIED"}))}}]),t}(j));function Lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function qt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lt(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ht=O(Ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Client/UI/login",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return qt({},e,{mem:qt({},e.mem,{ui:qt({},e.mem.ui,{user:t.message.user,service:void 0,response:[]})})})}}]),t}(j)),Bt=O(Ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Client/UI/selectService",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){var n=qt({},e,{mem:qt({},e.mem,{ui:qt({},e.mem.ui,{service:t.message.service,response:[]})})});if(void 0!==n.mem.ui.service){var a=n.mem.db.consentRefByUser[n.mem.ui.user],r=void 0===a?void 0:a[n.mem.ui.service];if(void 0===r||null===r)return this.send(n,k(t.arena,e,[e.mem.db.consentServiceId],jt({clientId:st(e.name),subjectId:e.mem.ui.user,purposeDeclarationId:t.message.service,callbackURL:e.name})()))}return n}}]),t}(j)),zt=O(Ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Client/UI/declarePurpose",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return this.send(e,k(t.arena,e,[e.mem.db.consentServiceId],mt()(t.message)))}}]),t}(j)),Kt=O(Ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Client/UI/fetchConsentReference",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return this.send(P(e,{consentRefByUser:Jt(e.mem.db.consentRefByUser,e.mem.ui.user,t.message.purposeDeclarationId,void 0)}),k(t.arena,e,[e.mem.db.consentServiceId],jt({clientId:st(e.name),purposeDeclarationId:t.message.purposeDeclarationId,subjectId:e.mem.ui.user,callbackURL:e.name})()))}}]),t}(j));function Jt(e,t,n,a){return qt({},e,Object(f.a)({},t,qt({},e[t],Object(f.a)({},n,a))))}O(Ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name=Ot,n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return qt({},e,{mem:qt({},e.mem,{db:qt({},e.mem.db,{consentRefByUser:Jt(e.mem.db.consentRefByUser,e.mem.ui.user,t.message.purposeDeclarationId,t.message.consentReference)})})})}}]),t}(j));var Gt=O(Ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Client/UI/executeRequest",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){var n=this,a=t.message,r=e.mem.db.consentRefByUser[e.mem.ui.user],c=void 0===r?void 0:r[a.purposeId],s=e.mem.config.find((function(e){return e.purposeDeclarationId===a.purposeId}));return void 0===s?(console.error("Unknown purpose? ",a),e):s.services.filter((function(e){return(void 0===a.serviceAddress||a.serviceAddress===e.serviceAddress)&&(void 0===a.serviceName||a.serviceName===e.serviceName)})).reduce((function(r,s){var i=ct(a.requestReference+s.serviceName+s.serviceAddress),l=(r.mem.ui.response||[]).filter((function(e){return!(e.purposeDeclarationId===a.purposeId&&e.serviceAddress===s.serviceAddress&&e.serviceName===s.serviceName)})).concat({requestReferenceId:i,purposeDeclarationId:a.purposeId,serviceAddress:s.serviceAddress,serviceName:s.serviceName,data:null}),o=qt({},e,{mem:qt({},e.mem,{ui:qt({},e.mem.ui,{response:l})})});return n.send(o,k(t.arena,o,[s.serviceAddress],Vt({clientId:st(o.name),serviceName:s.serviceName,subjectId:o.mem.ui.user,consentReference:c,requestReference:i})()))}),e)}}]),t}(j));function Wt(){return ct(""+(1e6*Math.random()|0))}var Xt=O(Ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name=It,n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return qt({},e,{mem:qt({},e.mem,{ui:qt({},e.mem.ui,{response:(e.mem.ui.response||[]).map((function(e){return e.requestReferenceId===t.message.asyncId?qt({},e,{data:t.message.records}):e}))})})})}}]),t}(j));O(Ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="error",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){switch(t.message.error){case"consent_not_found":return P(e,{consentRefByUser:Jt(e.mem.db.consentRefByUser,e.mem.ui.user,e.mem.ui.service,null)})}return console.log("Unknown error, ignoring: ",t),e}}]),t}(j));var $t=O(Ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="CS/UI/dumpConsentRefCache",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return void 0!==t.message.purposeDeclarationId?P(e,{consentRefByUser:Jt(e.mem.db.consentRefByUser,e.mem.ui.user,t.message.purposeDeclarationId,void 0)}):P(e,{consentRefByUser:{}})}}]),t}(j)),Qt=O(Ye,function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).name="Client/UI/validateConsentRef",n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"handle",value:function(e,t){return this.send(e,k(t.arena,e,[t.message.consentServiceId||e.mem.db.consentServiceId],xt({partyId:e.name,consentReference:t.message.consentReference})()))}}]),t}(j)),Zt="login",Yt="selectService",en="waitForConsent",tn="consentNotFound",nn="serviceV1",an=function(e){var t=e.t,r=e.props;return a.createElement("div",{className:"app-header"},a.createElement(Re,{arena:r.arena,owner:r.process,className:"btn btn-success btn-health",text:t("logout"),message:Ht()}),a.createElement("div",{className:"app-user-icon"},a.createElement("img",{alt:"user icon",src:n(87)})),a.createElement("p",{className:"app-user"},t("hello").replace("USERNAME",G(r.process.mem.ui.user))))};function rn(e){return void 0===e.ui.user?Zt:void 0===e.ui.service?Yt:void 0===e.db.consentRefByUser[e.ui.user]||void 0===e.db.consentRefByUser[e.ui.user][e.ui.service]?en:null===e.db.consentRefByUser[e.ui.user][e.ui.service]?tn:nn}var cn=function(e){function t(e){var n;switch(Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).sendMessagesFor=function(e){var t=n.props.process.mem;switch(e){case en:return void(void 0===t.ui.user||void 0===t.ui.service||void 0!==t.db.consentRefByUser[t.ui.user]&&void 0!==t.db.consentRefByUser[t.ui.user][t.ui.service]&&null!==t.db.consentRefByUser[t.ui.user][t.ui.service]||n.props.send(n.props,Kt({purposeDeclarationId:t.ui.service})));case nn:return void n.props.send(n.props,Gt({requestReference:Wt(),purposeId:t.ui.service}))}},n.state={view:Zt,loading:!1},n.changeView=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];n.setState({loading:!0}),t&&n.sendMessagesFor(e),setTimeout((function(){n.setState({loading:!1,view:e})}),600)},n.state={loading:!1,view:rn(e.process.mem)},n.state.view){case en:n.sendMessagesFor(n.state.view)}return n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.componentDidUpdate()}},{key:"componentDidUpdate",value:function(){var e=rn(this.props.process.mem);e!==this.state.view&&this.setState({view:e})}},{key:"render",value:function(){var e=this,t=this.props.process.mem,r=this.props.t,c=a.createElement(Re,{arena:this.props.arena,owner:this.props.process,className:"btn btn-light border",onClick:function(){return e.changeView(Yt)},message:Bt(),text:r("return")});switch(this.state.loading){case!0:return a.createElement("div",{className:"d-flex align-items-center"},a.createElement("strong",null,"Loading..."),a.createElement("div",{className:"spinner-border ml-auto",role:"status","aria-hidden":"true"}));default:switch(this.state.view){case Zt:return a.createElement("div",null,a.createElement("form",null,a.createElement("h4",null,r("please_login")),a.createElement("div",null,a.createElement("div",{className:"input-group"},a.createElement("input",{className:"form-control",size:10,name:"user",defaultValue:"47302200234"}),a.createElement("div",{className:"input-group-append"},a.createElement(Re,{arena:this.props.arena,owner:this.props.process,className:"btn btn-light border",onClick:function(){return e.changeView(Yt)},message:Ht(),text:r("login")})))),a.createElement("p",{className:"mt-4 mb-0"},a.createElement("img",{alt:"illustration",src:n(88),width:"280"}))));case Yt:return a.createElement("div",null,a.createElement(an,{t:r,props:this.props}),a.createElement("h4",null,r("choose_service")),this.props.process.mem.config.map((function(t){return a.createElement(Re,{key:t.purposeDeclarationId,className:"btn btn-dark mt-2 mr-2",arena:e.props.arena,owner:e.props.process,onClick:function(){return e.changeView(en)},message:Bt({service:t.purposeDeclarationId}),text:r("service",t.purposeDeclarationId,"name")})})));case en:return a.createElement("div",null,a.createElement(an,{t:r,props:this.props}),a.createElement("h4",null,r("checking_consent")),a.createElement("p",{className:"text-left"},r("retry_if_timed_out")),a.createElement(Re,{className:"btn btn-dark",arena:this.props.arena,owner:this.props.process,message:Kt({purposeDeclarationId:t.ui.service}),text:r("retry-fetch")}));case tn:return a.createElement("div",null,a.createElement(an,{t:r,props:this.props}),a.createElement("h4",null,r("service",t.ui.service,"consent-header")),a.createElement("p",{className:"text-left"},a.createElement("small",{dangerouslySetInnerHTML:{__html:r("service",t.ui.service,"consent-intro")}})),a.createElement("p",null,a.createElement("button",{className:"btn btn-lg btn-primary",onClick:function(n){return window.open("/ui/csui",e.props.arena+" - "+t.db.consentServiceId)}},"Annan n\xf5usoleku")),a.createElement("p",null,c));case nn:return a.createElement("div",null,a.createElement(an,{t:r,props:this.props}),a.createElement("h4",null,r("consented_data")),(t.ui.response||[]).filter((function(e){return e.purposeDeclarationId===t.ui.service})).map((function(e){return a.createElement("span",{className:"card",key:e.serviceAddress+" "+e.serviceName},a.createElement("pre",{className:"text-left"},e.serviceAddress,"/",e.serviceName,": ",JSON.stringify(e.data,void 0," ")))})),a.createElement("p",null,a.createElement(Re,{owner:this.props.process,arena:this.props.arena,message:Gt({requestReference:Wt(),purposeId:t.ui.service}),text:r("load-consented-data")})),a.createElement("p",null,c));default:return a.createElement("div",null,"Unimplemented view: ",this.state.view)}}}}]),t}(a.PureComponent),sn=Object(i.b)(null,{send:function(e,t){return k(e.arena,e.process,[e.process.name],t())}})(cn),ln=function(e){var t=e.process,n=e.arena,r=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return K.apply(void 0,[{arena:n,process:t}].concat(a))},c=a.useState(!1),s=Object(x.a)(c,2),i=s[0],l=s[1],o=function(){return l(!1)};return a.createElement(a.Fragment,null,a.createElement(ae.a,{show:i,onHide:o,size:"lg",bsPrefix:"client-app modal"},a.createElement(ae.a.Header,null,a.createElement(ae.a.Title,null,r("title"))),a.createElement(ae.a.Body,null,a.createElement(sn,{arena:n,process:t,t:r})),a.createElement(ae.a.Footer,null,a.createElement(re.a,{variant:"outline-dark",onClick:o},r("close")))),a.createElement(re.a,{variant:"success",className:"mr-2 btn-health",onClick:function(){return l(!0)}},r("open-end-user-view")))};var on=function(e){var t,n,a=e.process,c=e.arena,s=function(e){return K({arena:c,process:a},e)},i=r.a.useState(!1),l=Object(x.a)(i,2),o=l[0],u=l[1],m=r.a.useState([]),d=Object(x.a)(m,2),p=d[0],v=d[1],f=function(){return u(!1)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(ae.a,{show:o,onHide:f,size:"lg"},r.a.createElement(ae.a.Header,{closeButton:!0},r.a.createElement(ae.a.Title,null,"Eesm\xe4rgideklaratsiooni registreerimine")),r.a.createElement("form",null,r.a.createElement(ae.a.Body,null,r.a.createElement("div",{className:"row"},r.a.createElement("small",{className:"ml-4 mr-4 mb-4 text-center"},s("purpose-decl-intro"))),r.a.createElement("div",{className:"ml-4 mr-4 mb-2 border-bottom"},r.a.createElement("h6",{className:"text-center"},s("declarer")," ",W(st(a.name),"name")," (",st(a.name),")"),r.a.createElement("input",{name:"clientId",type:"hidden",value:st(a.name)})),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},(n=v,void 0===(t=a).mem.declTemplate||0===t.mem.declTemplate.length?r.a.createElement(r.a.Fragment,null):r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"prefilled"},"Eelt\xe4idetud deklaratsiooni kiirvalik"),r.a.createElement("select",{className:"form-control",id:"prefilled",onChange:function(e){return function(e,t,n){e.preventDefault();var a=e.currentTarget.value,r=e.currentTarget.form,c=t.find((function(e){return e.purposeDeclarationId===a}));void 0!==c&&(r.name.value=c.name,r.purposeDeclarationId.value=c.purposeDeclarationId,r.description.value=c.description,void 0!==c.services&&n(c.services))}(e,t.mem.declTemplate,n)},defaultValue:""},r.a.createElement("option",{key:"none",value:""},"... vali eelt\xe4idetud deklaratsioon ..."),t.mem.declTemplate.map((function(e){return r.a.createElement("option",{key:e.purposeDeclarationId,value:e.purposeDeclarationId},e.name)}))))),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"dIdentifier"},"Eesm\xe4rgideklaratsiooni identifikaator:"),r.a.createElement("input",{name:"purposeDeclarationId",type:"text",className:"form-control",id:"dIdentifier"}),r.a.createElement("small",{id:"dIdentifierHelp",className:"form-text text-muted"},"Klientrakenduse poolt m\xe4\xe4ratud eesm\xe4rgideklaratsiooni identifikaator")),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"dName"},"Eesm\xe4rgideklaratsiooni nimi:"),r.a.createElement("input",{name:"name",type:"text",className:"form-control",id:"dName"}),r.a.createElement("small",{id:"dNameHelp",className:"form-text text-muted"},"Eesm\xe4rgi l\xfchike nimi kasutajale n\xe4itamiseks"))),r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"dataUsage"},"Andmete kasutamise eesm\xe4rk:"),r.a.createElement("textarea",{name:"description",className:"form-control",id:"dataUsage",rows:5}),r.a.createElement("small",{id:"dataUsageHelp",className:"form-text text-muted"},"Andmesubjekti andmete t\xf6\xf6tlemise eesm\xe4rk. Kuvatakse n\xf5usoleku andmisel andmesubjektile.")),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"services"},"Kasutatavad teenused:"),r.a.createElement("select",{name:"services",className:"custom-select",multiple:!0,id:"services",value:p.map((function(e){return JSON.stringify(e)})),onChange:function(){}},p.map((function(e){return r.a.createElement("option",{key:JSON.stringify(e),value:JSON.stringify(e)},e.serviceProviderId," / ",e.serviceDeclarationId)}))),r.a.createElement("input",{name:"_spId",placeholder:"teenusepakkuja id",size:10}),r.a.createElement("input",{name:"_sdId",placeholder:"teenuse deklaratsiooni id",size:10}),r.a.createElement("button",{className:"btn-sm",onClick:function(e){return function(e,t,n){e.preventDefault();var a=e.currentTarget.form,r=a._spId.value,c=a._sdId.value;r.match("^[!-~]+$")&&c.match("^[!-~]+$")&&(n((function(e){return e.concat({serviceProviderId:r,serviceDeclarationId:c})})),a._spId.value=a._sdId.value="")}(e,0,v)}},"+"),r.a.createElement("button",{className:"btn-sm",onClick:function(e){e.preventDefault(),v([])},title:s("clear")},"X"))))),r.a.createElement(ae.a.Footer,null,r.a.createElement(re.a,{variant:"secondary",onClick:f},"Close"),r.a.createElement(Re,{arena:c,owner:a,onClick:function(){return f()},text:s("declare"),message:zt()})))),r.a.createElement(re.a,{variant:"dark",onClick:function(){return u(!0)}},s("declare")))};function un(e){return void 0!==e.mem.ui.user}S(Ye,et,(function(e){var t=e.process,n=e.arena,a=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return K.apply(void 0,[{arena:n,process:t}].concat(a))},c=Object.keys(t.mem.db.purpose).length,s=function(e){var t=0;return Object.keys(e.mem.db.consentRefByUser).forEach((function(n){t+=Object.keys(e.mem.db.consentRefByUser[n]).filter((function(t){return null!==e.mem.db.consentRefByUser[n][t]})).length})),t}(t),i=(t.mem.ui.response||[]).filter((function(e){return null!==e.data})).length;return r.a.createElement("div",null,r.a.createElement("p",null,un(t)?"".concat(a("active-user")," : ").concat(t.mem.ui.user):"".concat(a("no-active-user"),".")),r.a.createElement("p",{className:"small"},c," ",a("services-configured"),r.a.createElement("br",null),s," ",a("consent-refs-cached"),r.a.createElement("br",null),i," ",a("responses-cached")),r.a.createElement("div",{className:"row mx-1"},r.a.createElement(ln,{arena:n,process:t}),r.a.createElement(on,{arena:n,process:t})),r.a.createElement("div",{className:"col"},s>0&&r.a.createElement(Re,{className:"btn-link mt-2",owner:t,arena:n,message:$t(),text:a("dump-consent-ref-cache")}),i>0&&r.a.createElement(Re,{className:"btn-link mt-2",owner:t,arena:n,message:Bt({service:t.mem.ui.service}),text:a("dump-response-cache")})),un(t)&&t.mem.config.map((function(e){return function(e,t,n,a){var c=(n.mem.db.consentRefByUser[n.mem.ui.user]||{})[t.purposeDeclarationId],s=void 0===c?e("consent-ref-not-asked"):null===c?e("consent-ref-not-found"):c;return r.a.createElement("span",{className:"card small",key:t.purposeDeclarationId},r.a.createElement("div",{className:"w-100 row no-gutters"},r.a.createElement("div",{className:"col-auto flex-fill"},r.a.createElement("p",null,e("service",t.purposeDeclarationId,"name"),r.a.createElement("br",null),e("consent-ref"),s)),r.a.createElement("div",{className:"col-auto"},r.a.createElement(Re,{className:"btn btn-sm",owner:n,arena:a,message:Gt({requestReference:Wt(),purposeId:t.purposeDeclarationId}),text:"GO",title:"Tee p\xe4ring k\xf5igile selle eesm\xe4rgi teenustele"}),r.a.createElement(Re,{className:"btn btn-sm",owner:n,arena:a,message:Kt({purposeDeclarationId:t.purposeDeclarationId}),text:e("fcr"),title:"K\xfcsi n\xf5usolekuviide uuesti"}),c&&r.a.createElement(Re,{className:"btn btn-sm",owner:n,arena:a,message:Qt({consentReference:c}),text:"vcr",title:"Valideeri n\xf5usolekuviide n\xf5usolekuteenuses"}),c&&r.a.createElement(Re,{className:"btn btn-sm",owner:n,arena:a,message:$t({purposeDeclarationId:t.purposeDeclarationId}),text:"rcr",title:"Unusta see n\xf5usolekuviide"}))),r.a.createElement("table",{className:"table"},r.a.createElement("tbody",null,t.services.map((function(c){var s=at(n.mem.ui.response||[],{purposeDeclarationId:t.purposeDeclarationId,serviceAddress:c.serviceAddress,serviceName:c.serviceName});return r.a.createElement("tr",null,r.a.createElement("td",null,c.serviceAddress,r.a.createElement("br",null),c.serviceName),r.a.createElement("td",null,s&&s.requestReferenceId),r.a.createElement("td",null,s&&(null===s.data?e("response-has-no-data"):r.a.createElement(r.a.Fragment,null,s.data.length,e("data-items-returned")))),r.a.createElement("td",null,r.a.createElement(Re,{className:"btn btn-sm",owner:n,arena:a,message:Gt({requestReference:Wt(),purposeId:t.purposeDeclarationId,serviceAddress:c.serviceAddress,serviceName:c.serviceName}),text:"GO",title:"Ainult see p\xe4ring"})))})))))}(a,e,t,n)})))}));S(tt,nt,(function(e){var t=e.process,n=e.arena,a=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return K.apply(void 0,[{process:t,arena:n}].concat(a))},c=Date.now()/1e3|0;return r.a.createElement("div",null,r.a.createElement("p",null,void 0!==t.mem.ui.user?"".concat(a("active-user")," : ").concat(t.mem.ui.user):"".concat(a("no-active-user"),".")),r.a.createElement("p",{className:"small"},t.mem.db.serviceDeclarations.length," ",a("service-declarations"),", ",r.a.createElement("br",null),t.mem.db.purposeDeclarations.length," ",a("purpose-declarations"),", ",r.a.createElement("br",null),t.mem.db.consents.filter((function(e){return!e.revoked&&e.validFrom<=c&&e.validUntil>=c})).length," ",a("active-consents"),", ",r.a.createElement("br",null),t.mem.db.consents.length," ",a("total-consents")),r.a.createElement(de,{process:t,arena:n,button:!0}," ",a("open-end-user-view")))})),N(tt,"/ui/csui");var mn=function(e){var t=e.currentTarget.form,n=t.consentMaxDurationSeconds.value=(t._mdValue.value-0)*t._mdUnit.value*24*3600;t._mdValue.className="form-control w-25"+(n<1?" is-invalid":"")};function dn(e){return void 0===e.mem.declTemplate||0===e.mem.declTemplate.length?r.a.createElement(r.a.Fragment,null):r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"prefilled"},"Eelt\xe4idetud deklaratsiooni kiirvalik"),r.a.createElement("select",{className:"form-control",id:"prefilled",onChange:function(t){return function(e,t){e.preventDefault();var n=e.currentTarget.value,a=e.currentTarget.form,r=t.find((function(e){return e.serviceDeclarationId===n}));if(void 0!==r){a.name.value=r.name,a.serviceDeclarationId.value=r.serviceDeclarationId,a.technicalDescription.value=r.technicalDescription,a.description.value=r.description,a.needSignature.checked=!0===r.needSignature;var c=r.consentMaxDurationSeconds||31536e3;(c=c/86400|0)>365?(a._mdValue.value=c/365|0,a._mdUnit.value=365):c>30?(a._mdValue.value=c/30|0,a._mdUnit.value=30):(a._mdValue.value=c,a._mdUnit.value=1),mn({currentTarget:a.consentMaxDurationSeconds})}}(t,e.mem.declTemplate)},defaultValue:""},r.a.createElement("option",{key:"none",value:""},"... vali eelt\xe4idetud deklaratsioon ..."),e.mem.declTemplate.map((function(e){return r.a.createElement("option",{key:e.serviceDeclarationId,value:e.serviceDeclarationId},e.name)}))))}var pn=function(e){var t=e.process,n=e.arena,a=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return K.apply(void 0,[{process:t,arena:n}].concat(a))},c=r.a.useState(!1),s=Object(x.a)(c,2),i=s[0],l=s[1],o=function(){return l(!1)};return r.a.createElement(r.a.Fragment,null,r.a.createElement(ae.a,{show:i,onHide:o,size:"lg"},r.a.createElement(ae.a.Header,{closeButton:!0},r.a.createElement(ae.a.Title,null,"Teenusedeklaratsiooni registreerimine")),r.a.createElement("form",null,r.a.createElement(ae.a.Body,null,r.a.createElement("div",{className:"row"},r.a.createElement("small",{className:"ml-4 mr-4 mb-4 text-center"},a("service-decl-intro"))),r.a.createElement("div",{className:"ml-4 mr-4 mb-2 border-bottom"},r.a.createElement("h6",{className:"text-center"},a("declarer")," ",W(st(t.name),"name")," (",st(t.name),")"),r.a.createElement("input",{name:"serviceProviderId",type:"hidden",value:st(t.name)})),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col"},dn(t),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"sdIdentifier"},"Teenusedeklaratsiooni identifikaator:"),r.a.createElement("input",{name:"serviceDeclarationId",type:"text",className:"form-control",id:"sdIdentifier"}),r.a.createElement("small",{id:"sdIdentifierHelp",className:"form-text text-muted"},"Andmekogu poolt m\xe4\xe4ratud teenusedeklaratsiooni masinloetav identifikaator.")),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"sdName"},"Teenusedeklaratsiooni nimi:"),r.a.createElement("input",{name:"name",type:"text",className:"form-control",id:"sdName"}),r.a.createElement("small",{id:"sdNameHelp",className:"form-text text-muted"},"Teenusedeklaratsiooni identifikaator inimloetaval kujul. Soovitatavalt teenuse kood/nimi ja vajadusel alamteenuse identifikaator.")),r.a.createElement("div",{className:"form-group"},r.a.createElement("div",{className:"form-check"},r.a.createElement("input",{name:"needSignature",className:"form-check-input",type:"checkbox",id:"signature",value:"true|false"}),r.a.createElement("label",{className:"form-check-label",htmlFor:"signature"},"Vajab digiallkirja?"),r.a.createElement("small",{id:"signatureHelp",className:"form-text text-muted"},"M\xe4rgista see v\xe4li, kui andmesubjekt peab selle teenuse andmetele n\xf5usoleku andmisel n\xf5usoleku digitaalselt allkirjastama.")))),r.a.createElement("div",{className:"col"},r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"sdTechDescription"},"Teenuse tehniline kirjeldus:"),r.a.createElement("textarea",{name:"technicalDescription",className:"form-control",id:"sdTechDescription",rows:5}),r.a.createElement("small",{id:"sdTechDescriptionHelp",className:"form-text text-muted"},"Teenuse ja selle osutamise tehniline kirjeldus. Kasutamiseks klients\xfcsteemide haldajatele")),r.a.createElement("div",{className:"form-group"},r.a.createElement("label",{htmlFor:"sdDescription"},"Teenuse andmekoosseisu kirjeldus:"),r.a.createElement("textarea",{name:"description",className:"form-control",id:"sdDescription",rows:5}),r.a.createElement("small",{id:"sdDescriptionHelp",className:"form-text text-muted"},"Teenuse inimloetav kirjeldus. Tagastatavad andmed, teenuse sisu jne. Kuvatakse n\xf5usoleku andmisel andmesubjektile.")),r.a.createElement("div",{className:"form-group"},r.a.createElement("input",{type:"hidden",name:"consentMaxDurationSeconds",value:31536e3}),r.a.createElement("label",{htmlFor:"maxDuration"},"N\xf5usoleku maksimaalne kehtivusaeg:"),r.a.createElement("div",{className:"form-inline"},r.a.createElement("input",{type:"number",size:3,className:"form-control w-25",id:"maxDuration",name:"_mdValue",onChange:mn,defaultValue:1}),r.a.createElement("select",{name:"_mdUnit",className:"form-control input-group-append",onChange:mn},r.a.createElement("option",{value:365},a("year")),r.a.createElement("option",{value:30},a("month")),r.a.createElement("option",{value:1},a("day")))))))),r.a.createElement(ae.a.Footer,null,r.a.createElement(re.a,{variant:"secondary",onClick:o},a("close")),r.a.createElement(Re,{arena:n,owner:t,onClick:function(){return o()},text:a("declare"),message:Ft()})))),r.a.createElement(re.a,{variant:"dark",onClick:function(){return l(!0)}},a("declare")))};function vn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}S(wt,Nt,(function(e){var t=e.process,n=e.arena,a=function(){for(var e=arguments.length,a=new Array(e),r=0;r<e;r++)a[r]=arguments[r];return K.apply(void 0,[{process:t,arena:n}].concat(a))},c=r.a.useState(!1),s=Object(x.a)(c,2),i=s[0],l=s[1],o=function(){return l(!1)},u=function(){var e=t.mem.services.map((function(e){return e.returnedDatatypes})).flat().concat(t.mem.db.map((function(e){return e.type})));e.sort();var n=[];return e.forEach((function(e){0!==n.length&&e===n[n.length-1]||n.push(e)})),n}();return r.a.createElement("div",null,r.a.createElement("p",{className:"small"},t.mem.services.length," ",a("services-defined"),r.a.createElement("br",null),t.mem.db.length," ",r.a.createElement("button",{className:"btn-link",onClick:function(){return l(!0)}},a("records-in-db"))),r.a.createElement(ae.a,{show:i,onHide:o,size:"lg"},r.a.createElement(ae.a.Header,null,r.a.createElement(ae.a.Title,null,a("database"),": ",a("title"))),r.a.createElement(ae.a.Body,null,r.a.createElement("form",null,r.a.createElement("table",{className:"table"},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{className:"border-top-0"},"id"),r.a.createElement("th",{className:"border-top-0"},"type"),r.a.createElement("th",{className:"border-top-0"},"subject"),r.a.createElement("th",{className:"border-top-0"},"data"),r.a.createElement("th",{className:"border-top-0"}))),r.a.createElement("tbody",null,t.mem.db.map((function(e){return r.a.createElement("tr",{key:e.key},r.a.createElement("td",null,e.key),r.a.createElement("td",null,e.type),r.a.createElement("td",null,e.subject),r.a.createElement("td",null,JSON.stringify(e.data,void 0," ")),r.a.createElement("td",null,r.a.createElement(Re,{arena:n,owner:t,text:"-",message:_t({key:e.key,datatype:void 0,subject:void 0,data:void 0})})))})),r.a.createElement("tr",{key:"add"},r.a.createElement("td",null,r.a.createElement("input",{className:"form-control",type:"text",size:10,name:"key",defaultValue:1e4*Math.random()|0})),r.a.createElement("td",null,r.a.createElement("input",{className:"form-control",type:"text",size:8,name:"datatype",defaultValue:u.length>0?u[0]:""})),r.a.createElement("td",null,r.a.createElement("input",{className:"form-control",type:"text",size:10,name:"subject"})),r.a.createElement("td",null,r.a.createElement("input",{className:"form-control",type:"text",size:10,name:"data"})),r.a.createElement("td",null,r.a.createElement(Re,{arena:n,owner:t,text:"+",message:_t(),onClick:function(e){var t=e.currentTarget.form;t.key.value=1e4*Math.random()|0,t.datatype.value="",t.subject.value="",t.data.value=""}}))))))),r.a.createElement(ae.a.Footer,null,r.a.createElement(re.a,{variant:"secondary",onClick:o},a("close")))),r.a.createElement(pn,{arena:n,process:t}))}));var fn,hn,bn,gn,En="EE/GOV/70009770/nt",yn={defaultArena:"demo",arenas:{demo:{processes:[(fn="EE/COM/10112345/healthstartup",hn=En,bn=[{purposeDeclarationId:"tervisepaevik_vaktsineerimised",services:[{serviceAddress:"EE/GOV/70009770/digilugu",serviceName:"hl7!1.3.6.1.4.1.28284.6.1.1.282"}]},{purposeDeclarationId:"tervisepaevik_visualiseerimine",services:[{serviceAddress:"EE/GOV/70009770/digilugu",serviceName:"hl7!1.3.6.1.4.1.28284.6.1.1.32"},{serviceAddress:"EE/GOV/70009770/digilugu",serviceName:"hl7!1.3.6.1.4.1.28284.6.1.1.35"}]}],gn=[{purposeDeclarationId:"tervisepaevik_visualiseerimine",name:"Terviseandmete visualiseerimine",description:"HealthStartup diagnooside ja uuringute tulemuste visualiseerimist pakkuv teenus.\n\nN\xf5usoleku tagasiv\xf5tmisel kustutab HealthStartup k\xf5ik Sinu kohta saadud andmed.",services:[{serviceProviderId:"EE/GOV/70009770",serviceDeclarationId:"hl7_diagnoosid"},{serviceProviderId:"EE/GOV/70009770",serviceDeclarationId:"hl7_uuringud"}]},{purposeDeclarationId:"tervisepaevik_vaktsineerimised",name:"Vaktsineerimiste meeldetuletused",description:"HealthStartup vaktsineerimiste meeldetuletusi ja immuniseerimisplaani pakkuv teenus.\n\nN\xf5usoleku tagasiv\xf5tmisel kustutab HealthStartup k\xf5ik Sinu kohta saadud andmed.",services:[{serviceProviderId:"EE/GOV/70009770",serviceDeclarationId:"hl7_immuniseerimispass"}]}],{type:Ye,view:et,name:fn,title:fn,mem:{ui:{},db:{consentServiceId:hn,consentRefByUser:{},purpose:{}},declTemplate:gn,config:bn},queue:[]}),function(e,t,n,a,r){return{type:wt,view:Nt,name:e,title:t,mem:{db:void 0===a?[]:a,services:n,inflight:[],declTemplate:r},queue:[]}}("EE/GOV/70009770/digilugu","Tervise Infos\xfcsteem",[{serviceName:"hl7!1.3.6.1.4.1.28284.6.1.1.282",consentService:En,requiredServiceDeclarationIds:["hl7_immuniseerimispass"],returnedDatatypes:["immuniseerimine"]},{serviceName:"hl7!1.3.6.1.4.1.28284.6.1.1.35",consentService:En,requiredServiceDeclarationIds:["hl7_uuringud"],returnedDatatypes:["uuring"]},{serviceName:"hl7!1.3.6.1.4.1.28284.6.1.1.32",consentService:En,requiredServiceDeclarationIds:["hl7_diagnoosid"],returnedDatatypes:["diagnoos"]}],[On("01234567890","diagnoos",{diagnoos:"A01",arst:"D03677"}),On("12345678901","diagnoos",{diagnoos:"J01",arst:"D08031"}),On("47302200234","diagnoos",{diagnoos:"J00",arst:"D05076"}),On("47302200234","uuring",{uuring:"uuring 1",arst:"D12345",vastus:"korras."}),On("47302200234","immuniseerimine",{haigus:"A-gripp",preparaat:"Vaxigriptetra",seeria:"A2321-3232",jrk:3,uuesti:"2020-10-22"})],[{serviceDeclarationId:"hl7_uuringud",name:"Uuringute p\xe4ring",technicalDescription:"X-tee teenuse 'hl7' p\xe4ring, HL7 OID: 1.3.6.1.4.1.28284.6.1.1.35",description:"Andmekogule saadetakse p\xe4ringu parameetrina Sinu isikukood.\n\nAndmekogust Tervise Infos\xfcsteem saadakse iga Sinu uuringu kohta j\xe4rgmised andmed:\n  * Sinu andmed: nimi ja isikukood:\n  * Uuringu andmed:\n    * Uuringu tegemise aeg ja koht (raviasutus)\n    * Proovimaterjali t\xfc\xfcp\n    * Uuringu t\xfc\xfcp\n    * Uuringu vastus\n  * Uuringu teostanud tervishoiut\xf6\xf6taja andmed: nimi, kood ja tervishoiuasutuse andmed",needSignature:!0,consentMaxDurationSeconds:15768e4},{serviceDeclarationId:"hl7_diagnoosid",name:"Diagnooside p\xe4ring",technicalDescription:"X-tee teenuse 'hl7' p\xe4ring, HL7 OID: 1.3.6.1.4.1.28284.6.1.1.32",description:"Andmekogust Tervise Infos\xfcsteem saadakse iga Sinu diagnoosi kohta j\xe4rgmised andmed:\n  * Sinu andmed: nimi ja isikukood\n  * Haigusjuhtumi andmed: diagnoosi andmise aeg, diagnoos\n  * Diagnoosi andnud tervishoiut\xf6\xf6taja andmed: nimi, kood ja tervishoiuasutuse andmed",needSignature:!0,consentMaxDurationSeconds:15768e4},{serviceDeclarationId:"hl7_immuniseerimispass",name:"Immuniseerimispassi p\xe4ring",technicalDescription:"X-tee teenuse 'hl7' p\xe4ring, HL7 OID: 1.3.6.1.4.1.28284.6.1.1.282",description:"Andmekogust Tervise Infos\xfcsteem saadakse iga Sinu immuniseerimise kohta j\xe4rgmised andmed:\n  * Sinu andmed: nimi ja isikukood\n  * Immuniseerimise andmed:\n    * Haigus mille vastu immuniseeriti\n    * Immuniseerimise kuup\xe4ev\n    * Immuunpreparaadi nimi, partii number ja manustatud annus\n    * Mitmes annus\n    * J\xe4rgmine immuniseerimise varaseim kuup\xe4ev\n  * Immuniseerija andmed: nimi, kood ja tervishoiuasutuse andmed",needSignature:!0,consentMaxDurationSeconds:15768e4}]),function(e){return{type:tt,view:nt,name:e,title:e,mem:{ui:{activePurposeDeclaration:{}},db:{serviceDeclarations:[],purposeDeclarations:[],consents:[],usageLog:[]}},queue:[]}}("EE/GOV/70009770/nt")],logRenderers:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vn(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},{})},singleCounter:{processes:[function(e){return{name:e,type:Ae,view:Ue,mem:0}}("counter1")]},tokenRing:{processes:[We("sd.title","a","b"),We("pd.title","b","c"),We("ca.title","c","c")]}}};function On(e,t,n){return{key:""+(1e4*Math.random()|0),type:t,subject:e,data:n}}function kn(){return{name:"theatre",arenas:be(Object.keys(yn.arenas).map((function(e){return function(e,t){return{name:e,process:be(t),log:[]}}(e,yn.arenas[e].processes)}))),active:yn.defaultArena}}function jn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function wn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jn(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Nn(e,t){return e.theatre.arenas.byName[t]}Object.keys(yn.arenas).forEach((function(e){void 0!==yn.arenas[e].logRenderers&&ne(e,yn.arenas[e].logRenderers)}));var Dn="Theatre/SELECT_ARENA";var In=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){n(86),n(240)}},{key:"render",value:function(){return r.a.createElement("div",null,r.a.createElement(Ie,{arena:this.props.theatre.arenas.byName[this.props.theatre.active]}))}}]),t}(r.a.PureComponent),Sn=Object(i.b)((function(e){return{theatre:e.theatre}}))(In);function Pn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Cn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pn(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var xn=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(v.a)(t,e),Object(m.a)(t,[{key:"login",value:function(e,t){console.log("login(",t,")"),e.preventDefault(),this.post(vt({user:t}))}},{key:"giveConsentByPurpose",value:function(e,t,n,a){var r=this;console.log("giveConsent(".concat(n,", ").concat(a,")")),e.preventDefault();t.map((function(e){return r.getServiceDeclaration(e).consentMaxDurationSeconds})).sort()[0];this.post(ft({dataSubject:this.mem.ui.user,clientId:n,purposeDeclarationId:a,validFrom:Date.now()/1e3|0,validUntil:this.getValidUntil(t),revoked:!1,consentReference:ct(n+a+Date.now())}))}},{key:"revokeConsent",value:function(e,t){console.log("revokeConsent(".concat(t,")")),e.preventDefault(),this.post(ht({consentReference:t,revokeAt:Math.floor(Date.now()/1e3)}))}},{key:"getConsents",value:function(e){if(void 0===this.mem)return[];var t=Date.now()/1e3|0,n=this.mem.ui.user;return this.mem.db.consents.map(kt(t)).filter((function(a){return a.dataSubject===n&&(void 0===e||e===(a.validFrom<=t&&a.validUntil>=t&&!a.revoked))}))}},{key:"getPDsWithoutValidConsent",value:function(){if(void 0===this.mem)return console.error("Not connected? No local state yet"),[];var e=this.getConsents(!0);return this.mem.db.purposeDeclarations.filter((function(t){return void 0===e.find((function(e){return e.clientId===t.clientId&&e.purposeDeclarationId===t.purposeDeclarationId}))}))}},{key:"getUsageLogRecords",value:function(){var e=this;return void 0===this.mem?[]:this.mem.db.usageLog.filter((function(t){return t.subjectId===e.mem.ui.user}))}},{key:"activatePurposeDeclaration",value:function(e,t){e.preventDefault(),void 0!==this.mem&&this.post(Et(t))}},{key:"getActivePurposeDeclaration",value:function(){if(void 0!==this.mem&&void 0!==this.mem.ui.activePurposeDeclaration&&void 0!==this.mem.ui.activePurposeDeclaration[this.mem.ui.user]){var e=at(this.mem.db.purposeDeclarations,Cn({},this.mem.ui.activePurposeDeclaration[this.mem.ui.user],{callbackURL:void 0}));if(void 0!==e&&void 0===at(this.getConsents(!0),{clientId:e.clientId,purposeDeclarationId:e.purposeDeclarationId}))return Cn({},e,{validUntil:this.getValidUntil(this.mem.db.serviceDeclarations)})}}},{key:"getServiceDeclaration",value:function(e){if(void 0!==this.mem)return at(this.mem.db.serviceDeclarations,e)}},{key:"getPurposeDeclaration",value:function(e){if(void 0!==this.mem)return at(this.mem.db.purposeDeclarations,e)}},{key:"getValidUntil",value:function(e){var t=this,n=e.map((function(e){return t.getServiceDeclaration(e).consentMaxDurationSeconds})).sort()[0];return Number(Math.floor(Date.now()/1e3))+Number(n)}}]),t}(L),Rn=r.a.createContext(void 0),An=function(){function e(){Object(u.a)(this,e)}return Object(m.a)(e,[{key:"use",value:function(){var e=Object(a.useContext)(Rn);return void 0===e||null===e?e:new xn(e)}}]),e}(),Un=function(){return a.createElement("footer",null,a.createElement("div",{className:"footer-top"},a.createElement("div",{className:"footer-contact"},a.createElement("div",null,a.createElement("div",{className:"footer-contact-icon"},a.createElement("i",{className:"icon-phone"}))),a.createElement("div",{className:"footer-contact-text"},a.createElement("table",null,a.createElement("tbody",null,a.createElement("tr",null,a.createElement("th",null,a.createElement("a",{className:"link-phone",href:"tel:+372-555-1"},"555 1234")),a.createElement("th",null,"\xdcldinfo")),a.createElement("tr",null,a.createElement("td",null,a.createElement("a",{className:"link-phone",href:"tel:+372-555-1234"},"555 1234")),a.createElement("td",null,"Teine osakond")),a.createElement("tr",null,a.createElement("td",null,a.createElement("a",{className:"link-phone",href:"tel:+372-555-1234"},"555 1234")),a.createElement("td",null,"Kolmas osakond")))),a.createElement("a",{className:"link-orange",href:"http://www.digilugu.ee/",target:"_blank",rel:"noopener noreferrer"},"K\xf5ik kontaktandmed")))))},Tn=function(e){var t=e.backend.use();return a.createElement(a.Fragment,null,a.createElement("nav",{className:"navbar"},a.createElement("ul",{className:"navbar-nav desktop-nav"},a.createElement("li",{className:"nav-item with-logo"},a.createElement("img",{className:"logo-brand",alt:"logo",width:"170",src:n(241)})),t&&t.mem.ui.user&&a.createElement("li",{className:"nav-item with-title"},a.createElement("p",{className:"nav-item-title"},"Kasutaja"),a.createElement("p",null,G(t.mem.ui.user))),t&&t.mem.ui.user&&a.createElement("li",{className:"nav-item nav-logout"},a.createElement("button",{className:"btn btn-logout",onClick:function(e){return t.login(e)}},"V\xe4ljun")))))},_n=function(e){var t=e.children,n=e.backend,a=n.use();return r.a.createElement("div",{className:"wrapper "+(a&&a.mem.ui.user?"push":"")},a&&a.mem.ui.user&&r.a.createElement(Tn,{backend:n}),r.a.createElement("div",{className:"content-wrapper"},r.a.createElement("div",{className:"workarea"},t)),r.a.createElement(Un,null))},Fn=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(d.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(r)))).onClick=function(){var e=n.props,t=e.label;(0,e.onClick)(t)},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.onClick,t=this.props,n=t.activeTab,a=t.label,c="sidebar-item";return n===a&&(c+=" active"),r.a.createElement("li",{className:c,onClick:e,style:{cursor:"pointer"}},a)}}]),t}(r.a.Component),Mn=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).onClickTabItem=function(e){n.setState({activeTab:e})},n.state={activeTab:n.props.children[0].props.label},n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this.onClickTabItem,t=this.props.children,n=this.state.activeTab;return r.a.createElement("div",null,r.a.createElement("div",{id:"sidebar"},r.a.createElement("ol",null,t.filter((function(e){return void 0!==e.props.label})).map((function(t){var a=t.props.label;return r.a.createElement(Fn,{activeTab:n,key:a,label:a,onClick:e})})))),r.a.createElement("div",{className:"section"},t.map((function(e){if(e.props.label===n)return e.props.children}))))}}]),t}(r.a.Component),Vn=function(e){var t=e.backend,n=e.consent,a=r.a.useState(!1),c=Object(x.a)(a,2),s=c[0],i=c[1],l=function(){return i(!1)};if(void 0===t.mem)return null;var o=t.mem.db.purposeDeclarations.find((function(e){return e.purposeDeclarationId===n.purposeDeclarationId}));if(void 0===o)return null;var u=function(e,t,n){return r.a.createElement("div",{className:"row",key:e},r.a.createElement("div",{className:"col-md"},r.a.createElement("div",{className:n?"d-flex align-items-end":"d-flex align-items-baseline"},r.a.createElement("div",null,r.a.createElement("h4",null," ",e)),r.a.createElement("div",null,t))))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(ae.a,{show:s,onHide:l,size:"lg"},r.a.createElement(ae.a.Header,null,r.a.createElement(ae.a.Title,null,"Detailid")),r.a.createElement(ae.a.Body,null,r.a.createElement((function(){var e=o.services.map((function(e){var n=t.getServiceDeclaration(e);return void 0===n?r.a.createElement(r.a.Fragment,null):r.a.createElement(r.a.Fragment,null,r.a.createElement("h4",null,n.name),it(n.description))}));return r.a.createElement("div",{className:"tab-info"},u("N\xf5usoleku saaja:","".concat(W(o.clientId,"name")," (").concat(W(o.clientId,"ntr"),")")),u("Rakendus:",o.name),u("N\xf5usolek antud:",Wn(n.validFrom)),Ln(n)?u("N\xf5usolek kehtib kuni:",Wn(n.validUntil)):u("N\xf5usolek t\xfchistatud:",Wn(n.validUntil)),u("Eesm\xe4rk:",it(o.description),!0),u("N\xf5usoleku alusel saab ".concat(W(o.clientId,"name")," Sinu kohta j\xe4rgmised andmed:"),e,!0))}),null)),r.a.createElement(ae.a.Footer,null,Ln(n)&&r.a.createElement(re.a,{variant:"primary",onClick:function(e){return function(e){i(!1),t.revokeConsent(e,n.consentReference)}(e)}},"V\xf5tan n\xf5usoleku tagasi"),r.a.createElement(re.a,{variant:"secondary",onClick:l},"Sule"))),r.a.createElement(re.a,{variant:"primary",onClick:function(){return i(!0)}},"Vaata l\xe4hemalt"))};function Ln(e){return!e.revoked&&e.validUntil>Date.now()/1e3}var qn=function(e){var t=function(t,n){return r.a.createElement(r.a.Fragment,null,r.a.createElement("h4",null,n),r.a.createElement("table",{className:"table align-middle"},r.a.createElement("tbody",null,t.map((function(t){return r.a.createElement("tr",{key:t.clientId},r.a.createElement("td",null,function(e){return"".concat(W(e.clientId,"name"),"; N\xf5usolek antud ").concat(Wn(e.validFrom))+" \u2013 ".concat(e.revoked?"n\xf5usolek t\xfchistatud":"kehtib kuni"," ").concat(Wn(e.validUntil))}(t)),r.a.createElement("td",null,r.a.createElement(Vn,{backend:e,consent:t})))})))))};return r.a.createElement("div",{label:"Minu n\xf5usolekud"}," ",function(e){if(0===e.getConsents().length)return r.a.createElement("p",null,"N\xf5usolekuid ei leitud.");var n=function(e,t){return r.a.createElement("h4",null,r.a.createElement("span",null,e),0===t&&r.a.createElement("span",{className:"badge badge-default ml-2"},r.a.createElement("span",{className:"badge-text"},"Puuduvad")))};return r.a.createElement(r.a.Fragment,null,t(e.getConsents(!0),n("Kehtivad n\xf5usolekud:",e.getConsents(!0).length)),t(e.getConsents(!1),n("Kehtetud n\xf5usolekud:",e.getConsents(!1).length)))}(e)," ")};var Hn=function(e){return r.a.createElement("div",{label:"N\xf5usolekute kasutamise ajalugu"},function(e){return 0===e.getUsageLogRecords().length?r.a.createElement("p",null,"N\xf5usolekute kasutamise s\xfcndmusi ei leitud."):r.a.createElement(r.a.Fragment,null,r.a.createElement("h4",null,"Ajalugu:"),r.a.createElement("table",{className:"table align-middle"},r.a.createElement("tbody",null,e.getUsageLogRecords().map((function(t){return r.a.createElement("tr",{key:t.clientId},r.a.createElement("td",null,function(e){return"OK"===e.result?Wn(e.usageTime,!0)+" "+W(e.clientId,"name")+" sai Sinu andmed n\xf5usoleku alusel":e.consentReference?Wn(e.usageTime,!0)+" "+W(e.clientId,"name")+" k\xfcsis, kuid ei saanud Sinu andmeid t\xfchistatud n\xf5usoleku alusel":Wn(e.usageTime,!0)+" "+W(e.clientId,"name")+" k\xfcsis, kuid ei saanud Sinu andmeid n\xf5usoleku puudumise t\xf5ttu"}(t)),t.consentReference?function(e,t){if(e.mem){var n=e.mem.db.consents.find((function(e){return e.consentReference===t}));if(n)return r.a.createElement("td",null,r.a.createElement(Vn,{backend:e,consent:n}))}}(e,t.consentReference):r.a.createElement(r.a.Fragment,null))})))))}(e))};function Bn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function zn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bn(n,!0).forEach((function(t){Object(f.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bn(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Kn=function(e){function t(e){var n;return Object(u.a)(this,t),(n=Object(d.a)(this,Object(p.a)(t).call(this,e))).state={signPopup:!1,returnPopup:!1},n.showConsentTab=n.showConsentTab.bind(Object(C.a)(n)),n}return Object(v.a)(t,e),Object(m.a)(t,[{key:"showSignPopup",value:function(e){this.setState((function(t){return zn({},t,{signPopup:e})}))}},{key:"showReturnPopup",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;this.setState((function(n){return zn({},n,{returnPopup:e,savedClientId:t})}))}},{key:"toggleSignPopup",value:function(){this.setState((function(e){return zn({},e,{signPopup:!e.signPopup})}))}},{key:"showConsentTab",value:function(e){e.preventDefault(),this.props.tabRef.current&&this.props.tabRef.current.onClickTabItem("Minu n\xf5usolekud")}},{key:"Popover",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(ae.a,{show:this.state.signPopup,onHide:function(){return e.toggleSignPopup()}},r.a.createElement(ae.a.Body,null,r.a.createElement("h4",null,"N\xf5usoleku andmiseks allkirjasta n\xf5usolek digitaalselt")),r.a.createElement(ae.a.Footer,null,r.a.createElement("button",{className:"btn btn-primary",onClick:function(t){e.props.backend.giveConsentByPurpose(t,e.props.activeDecl.services,e.props.activeDecl.clientId,e.props.activeDecl.purposeDeclarationId),e.toggleSignPopup(),e.showReturnPopup(!0,e.props.activeDecl.clientId)}},"Allkirjasta"),r.a.createElement(re.a,{variant:"secondary",onClick:function(t){return e.toggleSignPopup()}},"Tagasi"))),r.a.createElement(re.a,{variant:"primary",className:"mr-2",onClick:function(t){return e.toggleSignPopup()}},"Anna n\xf5usolek"),r.a.createElement(re.a,{variant:"secondary",onClick:function(e){return window.close()}},"Ei anna n\xf5usolekut"))}},{key:"ReturnScreen",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement("h4",null,"N\xf5usolek ",W(this.state.savedClientId,"name"),"-le on antud!"),r.a.createElement("p",null,"K\xf5iki oma antud n\xf5usolekuid n\xe4ed ja saad hallata siit ",r.a.createElement("a",{href:"/ui/csui",onClick:this.showConsentTab},"Minu n\xf5usolekud")),r.a.createElement("button",{className:"btn btn-primary",onClick:function(){window.close(),e.showReturnPopup(!1)}},"Tagasi teenusesse"))}},{key:"render",value:function(){var e=this,t=this.props.activeDecl;return void 0===t?this.state.returnPopup?this.ReturnScreen():r.a.createElement("div",null,"Avatud taotlust pole."):r.a.createElement("div",{className:"tab-info"},r.a.createElement("h4",{className:"mb-4 title"},W(t.clientId,"name")," (",W(t.clientId,"ntr"),") k\xfcsib n\xf5usolekute j\xe4rgmistel tingimustel:"),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md"},r.a.createElement("div",{className:"d-flex align-items-baseline"},r.a.createElement("div",null,r.a.createElement("h4",null,"Kirjeldus")),r.a.createElement("div",null,it(t.description))))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md"},r.a.createElement("div",{className:"d-flex align-items-end"},r.a.createElement("div",null,r.a.createElement("h4",null,"Kehtivus")),r.a.createElement("div",null,t.validUntil&&"Kehtib kuni: ".concat(Wn(t.validUntil)))))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md"},r.a.createElement("div",{className:"d-flex align-items-end"},r.a.createElement("div",null,r.a.createElement("h4",null,"N\xf5usoleku alusel saab ",W(t.clientId,"name")," Sinu kohta j\xe4rgmised andmed:")),r.a.createElement("div",null,t.services.map((function(t){var n=e.props.backend.getServiceDeclaration(t);return void 0===n?r.a.createElement(r.a.Fragment,null):r.a.createElement(r.a.Fragment,null,r.a.createElement("h4",null,n.name),it(n.description))})))))),r.a.createElement("div",{className:"row"},r.a.createElement("div",{className:"col-md mt-4 mb-2 text-muted"},"Antud n\xf5usoleku saad igal ajal t\xfchistada oma n\xf5usolekute vaatest ",r.a.createElement("a",{href:"/ui/csui",onClick:this.showConsentTab},"Minu n\xf5usolekud"))),r.a.createElement("p",{className:"mt-4"},this.Popover()))}}]),t}(r.a.PureComponent),Jn=function(e){var t=e.backend,n=e.tabRef,a=t.use();if(null===a||void 0===a)return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"section"},"Wait, or reinit the client UI from the arena window... '",window.name,"'"));if(void 0===a.mem.ui.user)return r.a.createElement("div",{className:"section"},r.a.createElement("h4",null,"N\xf5usoleku andmiseks sisene Tervise- ja Heaolu Infos\xfcsteemide Keskuse n\xf5usolekute andmise keskkonda:"),r.a.createElement("p",{className:"mt-3"},r.a.createElement("a",{href:"/ui/ria",className:"btn btn-primary"},"Sisene")));var c=a.getActivePurposeDeclaration();return r.a.createElement(Mn,{ref:n},r.a.createElement("div",{label:"Avatud taotlused"},r.a.createElement(Kn,{label:"Avatud taotlused",backend:a,activeDecl:c,tabRef:n})),qn(a),Hn(a))},Gn=function(e){function t(e,n){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e,n))).backendLink=void 0,a.backend=void 0,a.ref=void 0,a.backendLink=new V((function(e){a.setState(e)}),xn),a.backend=new An,a.ref=r.a.createRef(),a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){document.body.classList.add("temp"),this.backendLink.resetState()}},{key:"render",value:function(){return r.a.createElement(Rn.Provider,{value:this.state},r.a.createElement(_n,{backend:this.backend},r.a.createElement(Jn,{backend:this.backend,tabRef:this.ref})))}}]),t}(r.a.PureComponent);function Wn(e,t){return t?Intl.DateTimeFormat("et",{year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}).format(new Date(1e3*e)):Intl.DateTimeFormat("et").format(new Date(1e3*e))}var Xn=function(e){function t(e,n){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(p.a)(t).call(this,e,n))).backendLink=void 0,a.backend=void 0,a.backendLink=new V((function(e){a.setState(e)}),xn),a.backend=new An,a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.backendLink.resetState()}},{key:"render",value:function(){return r.a.createElement(Rn.Provider,{value:this.state},r.a.createElement($n,{backend:this.backend}))}}]),t}(r.a.PureComponent),$n=function(e){var t=e.backend.use();if(!t)return r.a.createElement("p",null,"Backend failed, close and reopen window.");return r.a.createElement("div",{className:"c-layout"},r.a.createElement("div",{className:"c-layout--full"},r.a.createElement("div",{className:"c-header-bar"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"d-flex justify-content-between align-items-center"},r.a.createElement("header",{role:"banner"},r.a.createElement("h1",{"aria-label":"Riigi autentimisteenus","aria-hidden":"true"}),r.a.createElement("p",{"aria-label":"Turvaline autentimine asutuste e-teenustes"},"Turvaline autentimine asutuste e-teenustes"))))),r.a.createElement("div",{className:"c-header"},r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"c-header__logo"},r.a.createElement("div",{className:"c-header__logo-link"},r.a.createElement("img",{src:n(242),"aria-hidden":"true",alt:""}))))),r.a.createElement("div",{className:"container"},r.a.createElement("div",{className:"c-tab-login"},r.a.createElement("main",{role:"main",className:"c-tab-login__main"},r.a.createElement("div",{className:"c-tab-login__content is-active","data-tab":"mobile-id","aria-hidden":"false"},r.a.createElement("div",{className:"c-tab-login__content-wrap"},r.a.createElement("div",{className:"c-tab-login__content-icon"},r.a.createElement("svg",{role:"img","aria-label":"",className:"icon icon-mobile-id"},r.a.createElement("use",{href:"#icon-mobile-id"}))),r.a.createElement("div",{className:"c-tab-login__content-text"},r.a.createElement("div",{role:"heading"},r.a.createElement("h2",null,"Mobiil-ID")),r.a.createElement("p",null,"Sisselogimiseks vajate kehtivat Mobiil-ID lepingut. Sisenemiseks Mobiil-ID-ga sisestage oma isikukood ja telefoninumber. Seej\xe4rel saadetakse Teie mobiiltelefonile kontrolls\xf5num."),r.a.createElement("form",null,r.a.createElement("table",null,r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{className:"col-label"},r.a.createElement("label",{htmlFor:"mid-personal-code",className:"form-label"},"Isikukood")),r.a.createElement("td",null,r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("span",{className:"input-group-text"},"EE")),r.a.createElement("input",{type:"text",id:"mid-personal-code",className:"form-control",name:"principalCode",defaultValue:"47302200234"})))),r.a.createElement("tr",null,r.a.createElement("td",{className:"col-label"},r.a.createElement("label",{htmlFor:"mid-phone-number",className:"form-label"},"Telefoninumber")),r.a.createElement("td",null,r.a.createElement("div",{className:"input-group"},r.a.createElement("div",{className:"input-group-prepend"},r.a.createElement("span",{className:"input-group-text"},"+372")),r.a.createElement("input",{type:"tel",id:"mid-phone-number",className:"form-control",name:"mobileNumber",defaultValue:"53883333"})))),r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",null,r.a.createElement("button",{className:"c-btn c-btn--primary",onClick:function(e){return function(e){e.preventDefault(),t.login(e,e.currentTarget.form.elements[0].value),window.location.href="/ui/csui"}(e)}},"J\xe4tkan")))))))),r.a.createElement("div",{className:"c-tab-login__footer"},r.a.createElement("p",null,r.a.createElement("a",{href:"https://tim.www.eesti.ee/tim/cancel-auth"},"Tagasi teenusepakkuja juurde")),r.a.createElement("p",null,r.a.createElement("a",{href:"https://www.id.ee/?id=35803&group_id=1",target:"_blank",rel:"noopener noreferrer"},"Abi id.ee lehelt"))))))),r.a.createElement("p",{className:"link-back-mobile"},r.a.createElement("a",{href:"https://tim.www.eesti.ee/tim/cancel-auth"},"Tagasi teenusepakkuja juurde")),r.a.createElement("svg",{"aria-hidden":"true",className:"c-inline-svg__hidden",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("defs",null,r.a.createElement("symbol",{id:"icon-mobile-id",viewBox:"0 0 20 32"},r.a.createElement("title",null,"mobile-id"),r.a.createElement("path",{d:"M7.218 28.027h5.476v1.12h-5.476zM15.876 31.68h-12.089c-0 0-0 0-0 0-1.8 0-3.261-1.454-3.271-3.252v-24.854c0.005-1.803 1.468-3.262 3.271-3.262 0 0 0 0 0 0h12.089c0 0 0 0 0 0 1.803 0 3.266 1.459 3.271 3.262v24.845c-0.005 1.803-1.468 3.262-3.271 3.262 0 0 0 0 0 0v0zM3.787 1.422c0 0 0 0-0 0-1.19 0-2.155 0.962-2.16 2.151v22.045h16.409v-22.044c0 0 0 0 0-0 0-1.188-0.963-2.151-2.151-2.151-0.003 0-0.006 0-0.009 0h0zM1.627 28.418c0.005 1.189 0.97 2.151 2.16 2.151 0 0 0 0 0 0h12.089c0 0 0 0 0 0 1.19 0 2.155-0.962 2.16-2.151v-1.689h-16.409zM12.382 8.951c-0.721-0.218-1.55-0.343-2.408-0.343-0.544 0-1.076 0.050-1.592 0.147l0.053-0.008c-0.018 0.004-0.039 0.006-0.060 0.006-0.154 0-0.282-0.108-0.313-0.252l-0-0.002c-0.009-0.089 0-0.169 0.053-0.231 0.047-0.068 0.119-0.117 0.202-0.133l0.002-0c0.494-0.094 1.063-0.147 1.644-0.147 0.922 0 1.813 0.135 2.653 0.386l-0.065-0.017c0.132 0.040 0.226 0.16 0.226 0.302 0 0.174-0.141 0.315-0.315 0.315-0.032 0-0.062-0.005-0.091-0.013l0.002 0.001zM14.187 11.396c-0 0-0.001 0-0.001 0-0.066 0-0.127-0.020-0.178-0.054l0.001 0.001c-1.129-0.791-2.531-1.263-4.043-1.263-1.375 0-2.659 0.391-3.747 1.067l0.030-0.017c-0.049 0.032-0.109 0.051-0.174 0.051-0.113 0-0.213-0.059-0.27-0.148l-0.001-0.001c-0.033-0.049-0.053-0.108-0.053-0.173 0-0.116 0.064-0.217 0.158-0.271l0.002-0.001c1.151-0.716 2.547-1.141 4.043-1.141 1.65 0 3.18 0.517 4.435 1.397l-0.025-0.016c0.142 0.089 0.178 0.293 0.089 0.436-0.059 0.081-0.153 0.133-0.26 0.133-0.002 0-0.005-0-0.007-0h0zM5.236 13.92c-0.176-0.001-0.318-0.144-0.318-0.32 0-0.070 0.023-0.135 0.061-0.188l-0.001 0.001c1.147-1.527 2.954-2.505 4.99-2.505 1.961 0 3.709 0.907 4.85 2.324l0.009 0.012c0.107 0.142 0.089 0.338-0.053 0.444-0.053 0.041-0.121 0.066-0.195 0.066-0.101 0-0.19-0.046-0.249-0.119l-0-0.001c-1.035-1.279-2.604-2.090-4.364-2.090-1.826 0-3.448 0.874-4.471 2.227l-0.010 0.014c-0.057 0.078-0.146 0.13-0.248 0.133l-0.001 0zM5.556 17.138c-0.003 0-0.006 0-0.009 0-0.172 0-0.311-0.139-0.311-0.311 0-0 0-0 0-0v0-0.018c0.161-2.486 2.216-4.441 4.728-4.441 2.137 0 3.943 1.415 4.534 3.358l0.009 0.034c0.004 0.018 0.006 0.039 0.006 0.061 0 0.177-0.143 0.32-0.32 0.32-0.128 0-0.238-0.075-0.289-0.183l-0.001-0.002v-0.018c-0.511-1.722-2.079-2.956-3.936-2.956-2.181 0-3.963 1.703-4.091 3.852l-0.001 0.011c-0.010 0.164-0.145 0.293-0.311 0.293-0.003 0-0.007-0-0.010-0h0zM7.004 19.387c-0.176-0-0.319-0.144-0.319-0.32 0-0.025 0.003-0.050 0.008-0.073l-0 0.002c0.082-0.236 0.129-0.507 0.129-0.79 0-0.116-0.008-0.231-0.023-0.343l0.001 0.013c-0.085-0.277-0.134-0.596-0.134-0.926 0-1.802 1.461-3.262 3.262-3.262 1.579 0 2.896 1.122 3.197 2.612l0.004 0.021c0.142 0.587 0.213 1.182 0.204 1.778 0 0.178-0.142 0.32-0.32 0.32-0.17-0.005-0.306-0.141-0.311-0.311v-0c0-0.551-0.062-1.102-0.178-1.636-0.291-1.16-1.325-2.005-2.556-2.005-1.453 0-2.631 1.178-2.631 2.631 0 0.222 0.028 0.439 0.080 0.645l-0.004-0.018c0.080 0.329 0.044 0.809-0.107 1.422-0.036 0.137-0.157 0.236-0.302 0.24h-0zM8.311 20.151l-0.089-0.009c-0.128-0.041-0.219-0.158-0.219-0.297 0-0.034 0.005-0.066 0.015-0.096l-0.001 0.002c0.169-0.456 0.266-0.982 0.266-1.531 0-0.244-0.019-0.483-0.056-0.717l0.003 0.026c-0.059-0.17-0.093-0.367-0.093-0.571 0-0.992 0.804-1.796 1.796-1.796 0.892 0 1.632 0.65 1.772 1.503l0.001 0.010c0.213 0.836 0.222 1.804 0.027 2.88-0.001 0.176-0.144 0.319-0.32 0.319s-0.32-0.143-0.32-0.32c0-0.038 0.007-0.074 0.018-0.107l-0.001 0.002c0.178-0.987 0.169-1.867-0.018-2.631-0.128-0.51-0.583-0.882-1.124-0.882-0.639 0-1.158 0.518-1.158 1.158 0 0.098 0.012 0.193 0.035 0.284l-0.002-0.008c0.16 0.64 0.089 1.502-0.222 2.56-0.043 0.13-0.163 0.222-0.305 0.222-0.002 0-0.005-0-0.007-0h0zM9.804 20.329c-0.172-0.005-0.31-0.147-0.31-0.32 0-0.025 0.003-0.050 0.008-0.073l-0 0.002c0.159-0.552 0.256-1.187 0.267-1.843l0-0.006c0-0.311-0.036-0.622-0.107-0.916-0.001-0.008-0.001-0.017-0.001-0.026 0-0.177 0.143-0.32 0.32-0.32 0.131 0 0.244 0.079 0.294 0.192l0.001 0.002c0.089 0.356 0.124 0.711 0.116 1.067-0.010 0.716-0.113 1.403-0.298 2.056l0.014-0.056c-0.036 0.137-0.157 0.236-0.302 0.24h-0z"}))))))},Qn=function(){var e=Object(z.b)().i18n,t=function(t){e.changeLanguage(t)};return r.a.createElement("div",{className:"App"},r.a.createElement(l.a,null,r.a.createElement(o.c,null,r.a.createElement(o.a,{path:"/ui/ria"},r.a.createElement(Xn,null)),r.a.createElement(o.a,{path:"/ui/csui"},r.a.createElement(Gn,null)),r.a.createElement(o.a,{path:"/"},r.a.createElement("nav",{className:"navbar navbar-light bg-light mb-4"},r.a.createElement("span",{className:"navbar-brand"},r.a.createElement("img",{alt:"logo",src:n(244),width:"40"})),r.a.createElement("div",{className:"language"},r.a.createElement("a",{href:"#!",onClick:function(e){e.preventDefault(),t("et")},className:"et"===e.language?"active":""},"et"),r.a.createElement("a",{href:"#!",onClick:function(e){e.preventDefault(),t("en")},className:"en"===e.language||"en-US"===e.language?"active":""},"en"))),r.a.createElement("div",{className:"container-fluid"},r.a.createElement(Sn,null))))))},Zn=function(){return r.a.createElement("div",{className:"App"},r.a.createElement("div",null,"loading..."))},Yn=function(){return r.a.createElement(a.Suspense,{fallback:r.a.createElement(Zn,null)},r.a.createElement(Qn,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ea=n(38),ta=n(136),na=n(137),aa=Object(ea.combineReducers)({theatre:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:kn(),t=arguments.length>1?arguments[1]:void 0;switch(t.type){case Dn:return wn({},e,{active:t.arena});default:return wn({},e,{arenas:he(e.arenas,(function(e){return Ne(e,t)}))})}}});var ra=function(){var e=[ta.a],t=ea.applyMiddleware.apply(void 0,e),n=Object(ea.createStore)(aa,Object(na.composeWithDevTools)(t));return n.subscribe((function(){return De(n)})),function(e){window.addEventListener("message",(function(t){if(t.data.type===T){var n=t.data.target.split(" - "),a=Object(x.a)(n,2),r=a[0],c=a[1],s=t.data.url;void 0===M.find((function(e){return e.arena===r&&e.process===c&&e.ui===t.source}))&&(console.log("Unregistered childwindow, registering: ",t.data),M.push(new F(r,c,e,s,t.source).registerListeners().stateChanged()),t.preventDefault())}}))}(n),n}();s.a.render(r.a.createElement(i.a,{store:ra},r.a.createElement(Yn,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},86:function(e,t,n){},87:function(e,t,n){e.exports=n.p+"static/media/user-icon.bdeaa261.svg"},88:function(e,t,n){e.exports=n.p+"static/media/login.9f370677.svg"}},[[139,1,2]]]);
//# sourceMappingURL=main.7055bbed.chunk.js.map